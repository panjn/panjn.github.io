<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>一文了解Paxos - 面向问题编程</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="面向问题编程"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="面向问题编程"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="背景  分布式系统中, 其中一个基础的问题是如何在不可靠硬件(低可用性)基础上构建可靠(高可用性)的服务, 要达成这个目标, 核心的手段就是复制(例如一份数据存3个副本). 而复制过程中的一致性问题, 最后都归结为Paxos的解决方案2   Paxos"><meta property="og:type" content="blog"><meta property="og:title" content="一文了解Paxos"><meta property="og:url" content="https://www.heapoverflow.cn/pages/wiki-paxos/"><meta property="og:site_name" content="面向问题编程"><meta property="og:description" content="背景  分布式系统中, 其中一个基础的问题是如何在不可靠硬件(低可用性)基础上构建可靠(高可用性)的服务, 要达成这个目标, 核心的手段就是复制(例如一份数据存3个副本). 而复制过程中的一致性问题, 最后都归结为Paxos的解决方案2   Paxos"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://www.heapoverflow.cn/img/vector_landscape_1.svg"><meta property="article:published_time" content="2022-03-13T01:03:31.731Z"><meta property="article:modified_time" content="2022-03-23T13:41:34.004Z"><meta property="article:author" content="面向问题编程"><meta property="article:tag" content="分布式一致性"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/vector_landscape_1.svg"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.heapoverflow.cn/pages/wiki-paxos/"},"headline":"一文了解Paxos","image":[],"datePublished":"2022-03-13T01:03:31.731Z","dateModified":"2022-03-23T13:41:34.004Z","author":{"@type":"Person","name":"面向问题编程"},"publisher":{"@type":"Organization","name":"面向问题编程","logo":{"@type":"ImageObject","url":"https://www.heapoverflow.cn/img/logo.svg"}},"description":"背景  分布式系统中, 其中一个基础的问题是如何在不可靠硬件(低可用性)基础上构建可靠(高可用性)的服务, 要达成这个目标, 核心的手段就是复制(例如一份数据存3个副本). 而复制过程中的一致性问题, 最后都归结为Paxos的解决方案2   Paxos"}</script><link rel="canonical" href="https://www.heapoverflow.cn/pages/wiki-paxos/"><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><script src="https://www.googletagmanager.com/gtag/js?id=G-ETGL163DQH" async></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
    
        gtag('config', 'G-ETGL163DQH');</script><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><script data-ad-client="ca-pub-6757924689439593" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" async></script><link rel="stylesheet" href="/css/base.min.css"><link rel="stylesheet" href="/css/fancy.min.css"><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }
          Array
              .from(document.querySelectorAll('.tab-content'))
              .forEach($tab => {
                  $tab.classList.add('is-hidden');
              });
          Array
              .from(document.querySelectorAll('.tabs li'))
              .forEach($tab => {
                  $tab.classList.remove('is-active');
              });
          const $activeTab = document.querySelector(location.hash);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
          const $tabMenu = document.querySelector(`a[href="${location.hash}"]`);
          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.0.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.svg" alt="面向问题编程" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">首页</a><a class="navbar-item" href="/categories/%E9%97%AE%E9%A2%98/">问题</a><a class="navbar-item" href="/categories/%E6%8A%80%E6%9C%AF%E6%9E%B6%E6%9E%84/">技术架构</a><a class="navbar-item" href="/categories/%E4%B8%80%E6%96%87%E4%BA%86%E8%A7%A3/">一文了解</a></div><div class="navbar-end"><a class="navbar-item" rel="noopener" title="分类" href="/categories">分类</a><a class="navbar-item" rel="noopener" title="标签" href="/tags">标签</a><a class="navbar-item" rel="noopener" title="归档" href="/archives">归档</a><a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-9-widescreen"><div class="card"><div class="card-image"><span class="image is-7by3"><img class="fill" src="/img/vector_landscape_1.svg" alt="一文了解Paxos"></span></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2022-03-13T01:03:31.731Z" title="2022/3/13 上午9:03:31">2022-03-13</time>发表</span><span class="level-item"><time dateTime="2022-03-23T13:41:34.004Z" title="2022/3/23 下午9:41:34">2022-03-23</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/%E4%B8%80%E6%96%87%E4%BA%86%E8%A7%A3/">一文了解</a></span><span class="level-item">19 分钟读完 (大约2905个字)</span></div></div><h1 class="title is-3 is-size-4-mobile">一文了解Paxos</h1><div class="content"><h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><article class="message is-warning" style="font-size:inherit">
<div class="message-body">
分布式系统中, 其中一个基础的问题是如何在不可靠硬件(低可用性)基础上构建可靠(高可用性)的服务, 要达成这个目标, 核心的手段就是复制(例如一份数据存3个副本). 而复制过程中的一致性问题, 最后都归结为Paxos的解决方案<sup>2</sup></div>
</article>

<h2 id="Paxos"><a href="#Paxos" class="headerlink" title="Paxos"></a>Paxos</h2><span id="more"></span>


<link rel="stylesheet" href="/css/wiki-paxos.css">
<div id="page-container">
<div id="pf1" class="pf w0 h0" data-page-no="1"><div class="pc pc1 w0 h0 opened"><img class="bi x0 y0 w0 h0" alt="" src="/img/wiki-paxos/bg1.jpg"><div class="t m0 x1 h1 y1 ff1 fs0 fc0 sc0 ls0 ws0">Paxos</div><div class="t m0 x1 h2 y2 ff2 fs1 fc1 sc0 ls0 ws0">可靠分布式系<span class="ff3">统</span>基<span class="ff3">础</span>：<span class="ff4">paxos</span>的直<span class="ff3">观</span>解<span class="ff3">释</span></div><div class="t m0 x2 h3 y3 ff4 fs2 fc2 sc0 ls0 ws0">2015-07-02  <span class="fc3">@drdrxp</span> </div><a class="l" target="_blank" rel="noopener" href="http://weibo.com/drdrxp"><div class="d m1" style="border-style:none;position:absolute;left:638.517460px;bottom:20.701456px;width:53.864440px;height:15.632814px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data="{&quot;ctm&quot;:[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}"></div></div>
<div id="pf2" class="pf w0 h0" data-page-no="2"><div class="pc pc2 w0 h0 opened"><img class="bi x0 y0 w0 h0" alt="" src="/img/wiki-paxos/bg2.jpg"><div class="t m0 x3 h4 y4 ff2 fs3 fc0 sc1 ls0 ws0">背景</div><div class="t m0 x3 h2 y5 ff2 fs1 fc1 sc0 ls0 ws0">多个<span class="ff3">节</span>点一起完成一件事情<span class="ff4">.</span></div><div class="t m0 x3 h2 y6 ff2 fs1 fc1 sc0 ls0 ws0">分布式中唯一的一个<span class="ff3">问题</span>：<span class="ff3">对</span>某事达成一致<span class="ff4">.</span></div><div class="t m0 x3 h2 y7 ff4 fs1 fc1 sc0 ls0 ws0">Paxos: <span class="ff2">分布式系<span class="ff3">统</span>的核心算法</span>.</div></div><div class="pi" data-data="{&quot;ctm&quot;:[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}"></div></div>
<div id="pf3" class="pf w0 h0" data-page-no="3"><div class="pc pc3 w0 h0 opened"><img class="bi x0 y0 w0 h0" alt="" src="/img/wiki-paxos/bg3.jpg"><div class="t m0 x3 h5 y4 ff2 fs3 fc0 sc1 ls0 ws0">目<span class="ff3">录</span></div><div class="t m0 x3 h2 y8 ff4 fs1 fc1 sc0 ls0 ws0">1. <span class="ff3">问题</span></div><div class="t m0 x3 h6 y9 ff4 fs1 fc1 sc0 ls0 ws0">2. <span class="ff2">复制策略</span></div><div class="t m0 x3 h6 ya ff4 fs1 fc1 sc0 ls0 ws0">3. Paxos <span class="ff2">算法</span></div><div class="t m0 x3 h2 yb ff4 fs1 fc1 sc0 ls0 ws0">4. Paxos <span class="ff3">优<span class="ff2">化</span></span></div></div><div class="pi" data-data="{&quot;ctm&quot;:[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}"></div></div>
<div id="pf4" class="pf w0 h0" data-page-no="4"><div class="pc pc4 w0 h0"><img class="bi x0 y0 w0 h0" alt="" src="/img/wiki-paxos/bg4.jpg"><div class="t m0 x3 h5 y4 ff3 fs3 fc0 sc1 ls0 ws0">问题</div><div class="t m0 x3 h2 y5 ff3 fs1 fc1 sc0 ls0 ws0">对<span class="ff2">系</span>统<span class="ff2">的需求<span class="ff4">:</span></span></div><div class="t m0 x4 h7 yc ff2 fs4 fc1 sc0 ls0 ws0">持久性要达到：<span class="ff4">99.99999999%</span></div><div class="t m0 x3 h2 yd ff2 fs1 fc1 sc0 ls0 ws0">我<span class="ff3">们</span>可以用的基<span class="ff3">础设</span>置<span class="ff4">:</span></div><div class="t m0 x4 h8 ye ff2 fs4 fc1 sc0 ls0 ws0">磁<span class="ff3">盘<span class="ff4">: <span class="_ _0"> </span>4% </span></span>年<span class="ff3">损</span>坏率</div><div class="t m0 x4 h8 yf ff2 fs4 fc1 sc0 ls0 ws0">服<span class="ff3">务</span>器宕机<span class="ff3">时间<span class="ff4">: <span class="_ _1"> </span>0.1% </span></span>或更<span class="ff3">长</span></div><div class="t m0 x4 h8 y10 ff4 fs4 fc1 sc0 ls0 ws0">IDC<span class="ff3">间丢<span class="ff2">包率</span></span>: <span class="_ _2"> </span>5% ~ 30%</div></div><div class="pi" data-data="{&quot;ctm&quot;:[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}"></div></div>
<div id="pf5" class="pf w0 h0" data-page-no="5"><div class="pc pc5 w0 h0"><img class="bi x0 y0 w0 h0" alt="" src="/img/wiki-paxos/bg5.jpg"><div class="t m0 x3 h4 y4 ff2 fs3 fc0 sc1 ls0 ws0">解决方案<span class="ff1 sc0">(</span>可能<span class="ff1 sc0">)</span></div><div class="t m0 x3 h6 y5 ff2 fs1 fc1 sc0 ls0 ws0">多副本</div><div class="t m0 x4 h2 y11 ff4 fs1 fc1 sc0 ls0 ws0">x&lt;n<span class="ff2">个副本<span class="ff3">损</span>坏不会<span class="ff3">丢</span>数据</span></div><div class="t m0 x3 h6 y12 ff2 fs1 fc1 sc0 ls0 ws0">多副本的可靠性<span class="ff4">:</span></div><div class="t m0 x4 h6 y7 ff4 fs1 fc1 sc0 ls0 ws0">1 <span class="ff2">副本</span>: ~ 0.63%</div><div class="t m0 x4 h6 y13 ff4 fs1 fc1 sc0 ls0 ws0">2 <span class="ff2">副本</span>: ~ 0.00395%</div><div class="t m0 x4 h6 y14 ff4 fs1 fc1 sc0 ls0 ws0">3 <span class="ff2">副本</span>: &lt; 0.000001%</div><div class="t m0 x4 h6 y15 ff4 fs1 fc1 sc0 ls0 ws0">n <span class="ff2">副本</span>: = 1 - x^n <span class="fs5">/* x = <span class="_ _3"></span><span class="ff3">单<span class="ff2">副本</span>损<span class="ff2">坏率</span></span> */</span></div></div><div class="pi" data-data="{&quot;ctm&quot;:[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}"></div></div>
<div id="pf6" class="pf w0 h0" data-page-no="6"><div class="pc pc6 w0 h0"><img class="bi x0 y0 w0 h0" alt="" src="/img/wiki-paxos/bg6.jpg"><div class="t m0 x3 h4 y4 ff2 fs3 fc0 sc1 ls0 ws0">解决方案<span class="ff1 sc0">.</span></div><div class="t m0 x5 h2 y16 ff2 fs1 fc1 sc0 ls0 ws0">如何<span class="ff3">实</span>施<span class="ff4">‘</span>复制<span class="ff4">’?</span></div><div class="t m0 x6 h9 y17 ff2 fs5 fc1 sc0 ls0 ws0">除了副本数之外，<span class="ff3">还</span>有<span class="ff4">:</span></div><div class="t m0 x7 ha y18 ff2 fs5 fc1 sc0 ls0 ws0">可用性</div><div class="t m0 x7 ha y19 ff2 fs5 fc1 sc0 ls0 ws0">原子性</div><div class="t m0 x7 ha y1a ff2 fs5 fc1 sc0 ls0 ws0">一致性</div><div class="t m0 x8 hb y1b ff4 fs5 fc1 sc0 ls0 ws0">...</div></div><div class="pi" data-data="{&quot;ctm&quot;:[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}"></div></div>
<div id="pf7" class="pf w0 h0" data-page-no="7"><div class="pc pc7 w0 h0"><img class="bi x0 y0 w0 h0" alt="" src="/img/wiki-paxos/bg7.jpg"><div class="t m0 x3 h5 y4 ff2 fs3 fc0 sc1 ls0 ws0">基<span class="ff3">础</span>的复制算法</div><div class="t m0 x3 h6 y1c ff2 fs1 fc1 sc0 ls0 ws0">主从异步复制</div><div class="t m0 x3 h6 y1d ff2 fs1 fc1 sc0 ls0 ws0">主从同步复制</div><div class="t m0 x3 h6 y1e ff2 fs1 fc1 sc0 ls0 ws0">主从半同步复制</div><div class="t m0 x3 h2 y1f ff2 fs1 fc1 sc0 ls0 ws0">多数派写（<span class="ff3">读</span>）</div></div><div class="pi" data-data="{&quot;ctm&quot;:[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}"></div></div>
<div id="pf8" class="pf w0 h0" data-page-no="8"><div class="pc pc8 w0 h0"><img class="bi x0 y0 w0 h0" alt="" src="/img/wiki-paxos/bg8.jpg"><div class="t m0 x3 h6 y20 ff2 fs1 fc1 sc0 ls0 ws0">如<span class="ff4">Mysql</span>的<span class="ff4">binlog</span>复制<span class="ff4">.</span></div><div class="t m0 x9 h8 y21 ff4 fs4 fc1 sc0 ls0 ws0">1.<span class="_ _4"> </span><span class="ff2">主接到写<span class="ff3">请</span>求</span>.</div><div class="t m0 x9 h8 y22 ff4 fs4 fc1 sc0 ls0 ws0">2.<span class="_ _4"> </span><span class="ff2">主写入本磁<span class="ff3">盘</span></span>.</div><div class="t m0 x9 h8 y23 ff4 fs4 fc1 sc0 ls0 ws0">3.<span class="_ _4"> </span><span class="ff2">主<span class="ff3">应</span>答</span>‘OK’.</div><div class="t m0 x9 h8 y24 ff4 fs4 fc1 sc0 ls0 ws0">4.<span class="_ _4"> </span><span class="ff2">主复制数据到从<span class="ff3">库</span></span>.</div><div class="t m0 x3 h2 y25 ff2 fs1 fc2 sc0 ls0 ws0">如果磁<span class="ff3">盘</span>在复制前<span class="ff3">损</span>坏：</div><div class="t m0 x3 h2 y26 ff4 fs1 fc2 sc0 ls0 ws0">→ <span class="ff2">数据<span class="ff3">丢</span>失</span>.</div><div class="t m0 x3 h4 y4 ff2 fs3 fc0 sc1 ls0 ws0">主从异步复制</div><div class="t m0 xa hb y27 ff4 fs5 fc2 sc0 ls0 ws0">Time</div><div class="t m0 xb h3 y28 ff4 fs2 fc2 sc0 ls0 ws0">Master<span class="_ _5"></span>Client<span class="_ _6"> </span>Slave.1<span class="_ _7"> </span>Slave.2</div><div class="t m0 xc hc y29 ff1 fs2 fc2 sc0 ls0 ws0">Disk Failure</div></div><div class="pi" data-data="{&quot;ctm&quot;:[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}"></div></div>
<div id="pf9" class="pf w0 h0" data-page-no="9"><div class="pc pc9 w0 h0"><img class="bi x0 y0 w0 h0" alt="" src="/img/wiki-paxos/bg9.jpg"><div class="t m0 x3 h4 y4 ff2 fs3 fc0 sc1 ls0 ws0">主从同步复制</div><div class="t m0 x9 h8 y2a ff4 fs4 fc1 sc0 ls0 ws0">1.<span class="_ _4"> </span><span class="ff2">主接到写<span class="ff3">请</span>求</span>.</div><div class="t m0 x9 h8 y2b ff4 fs4 fc1 sc0 ls0 ws0">2.<span class="_ _4"> </span><span class="ff2">主复制日志到从<span class="ff3">库</span></span>.</div><div class="t m0 x9 h8 y2c ff4 fs4 fc1 sc0 ls0 ws0">3.<span class="_ _4"> </span><span class="ff2">从<span class="ff3">库这时</span>可能阻塞</span>...</div><div class="t m0 x9 h8 y2d ff4 fs4 fc1 sc0 ls0 ws0">4.<span class="_ _4"> </span><span class="ff2">客<span class="ff3">户</span>端一直在等<span class="ff3">应</span>答</span>’OK’<span class="ff2">，直到</span></div><div class="t m0 x4 h8 y2e ff2 fs4 fc1 sc0 ls0 ws0">所有从<span class="ff3">库</span>返回<span class="ff4">.</span></div><div class="t m0 x3 h2 y2f ff2 fs1 fc2 sc0 ls0 ws0">一个失<span class="ff3">联节</span>点造成整个系<span class="ff3">统</span></div><div class="t m0 x3 h6 y30 ff2 fs1 fc2 sc0 ls0 ws0">不可用<span class="ff4">.</span></div><div class="t m0 x3 h2 y31 ff4 fs1 fc2 sc0 ls0 ws0">: <span class="ff2">没有数据<span class="ff3">丢</span>失</span>.</div><div class="t m0 x3 h6 y32 ff4 fs1 fc2 sc0 ls0 ws0">: <span class="ff2">可用性降低</span>.</div><div class="t m0 xa hb y27 ff4 fs5 fc2 sc0 ls0 ws0">Time</div><div class="t m0 xb h3 y28 ff4 fs2 fc2 sc0 ls0 ws0">Master<span class="_ _5"></span>Client<span class="_ _6"> </span>Slave.1<span class="_ _7"> </span>Slave.2</div></div><div class="pi" data-data="{&quot;ctm&quot;:[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}"></div></div>
<div id="pfa" class="pf w0 h0" data-page-no="a"><div class="pc pca w0 h0"><img class="bi x0 y0 w0 h0" alt="" src="/img/wiki-paxos/bga.jpg"><div class="t m0 x3 h4 y4 ff2 fs3 fc0 sc1 ls0 ws0">主从半同步复制</div><div class="t m0 x9 h8 y33 ff4 fs4 fc1 sc0 ls0 ws0">1.<span class="_ _4"> </span><span class="ff2">主接到写<span class="ff3">请</span>求</span>.</div><div class="t m0 x9 h8 y34 ff4 fs4 fc1 sc0 ls0 ws0">2.<span class="_ _4"> </span><span class="ff2">主复制日志到从<span class="ff3">库</span></span>.</div><div class="t m0 x9 h8 y35 ff4 fs4 fc1 sc0 ls0 ws0">3.<span class="_ _4"> </span><span class="ff2">从<span class="ff3">库这时</span>可能阻塞</span>...</div><div class="t m0 x9 h8 y36 ff4 fs4 fc1 sc0 ls0 ws0">4.<span class="_ _4"> </span><span class="ff2">如果</span>1&lt;=x&lt;=n<span class="ff2">个从<span class="ff3">库</span>返回</span>‘OK’<span class="ff2">，</span></div><div class="t m0 x4 h8 y37 ff3 fs4 fc1 sc0 ls0 ws0">则<span class="ff2">返回客</span>户<span class="ff2">端<span class="ff4">‘OK’.</span></span></div><div class="t m0 x3 h6 y38 ff4 fs1 fc2 sc0 ls0 ws0">: <span class="ff2">高可靠性</span>.</div><div class="t m0 x3 h6 y1f ff4 fs1 fc2 sc0 ls0 ws0">: <span class="ff2">高可用性</span>.</div><div class="t m0 x3 h2 y39 ff4 fs1 fc2 sc0 ls0 ws0">: <span class="ff2">可能任何从<span class="ff3">库</span>都不完整</span></div><div class="t m0 x3 h9 y3a ff4 fs5 fc2 sc0 ls0 ws0">→  <span class="ff2">我<span class="ff3">们</span>需要</span> <span class="ff2">多数派写</span>(<span class="ff3">读</span>)</div><div class="t m0 xa hb y27 ff4 fs5 fc2 sc0 ls0 ws0">Time</div><div class="t m0 xb h3 y28 ff4 fs2 fc2 sc0 ls0 ws0">Master<span class="_ _5"></span>Client<span class="_ _6"> </span>Slave.1<span class="_ _7"> </span>Slave.2</div></div><div class="pi" data-data="{&quot;ctm&quot;:[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}"></div></div>
<div id="pfb" class="pf w0 h0" data-page-no="b"><div class="pc pcb w0 h0"><img class="bi x0 y0 w0 h0" alt="" src="/img/wiki-paxos/bgb.jpg"><div class="t m0 x3 h4 y4 ff2 fs3 fc0 sc1 ls0 ws0">多数派写</div><div class="t m0 x3 hd y1c ff4 fs1 fc1 sc0 ls0 ws0">Dynamo / Cassandra</div><div class="t m0 x3 h8 y3b ff2 fs4 fc1 sc0 ls0 ws0">客<span class="ff3">户</span>端写入<span class="ff4">W &gt;=N/2+1</span>个<span class="ff3">节</span>点<span class="ff4">.</span></div><div class="t m0 x3 h7 y3c ff2 fs4 fc1 sc0 ls0 ws0">不需要主<span class="ff4">.</span></div><div class="t m0 x3 h8 y3d ff2 fs4 fc1 sc0 ls0 ws0">多数派<span class="ff3">读<span class="ff4">:</span></span></div><div class="t m0 x3 he y3e ff4 fs4 fc1 sc0 ls0 ws0">W + R &gt; N; R &gt;= N/2+1</div><div class="t m0 x3 h8 y3f ff2 fs4 fc1 sc0 ls0 ws0">容忍最多<span class="ff4">(N-1)/2</span>个<span class="ff3">节</span>点<span class="ff3">损</span>坏<span class="ff4">.</span></div><div class="t m0 xa hb y27 ff4 fs5 fc2 sc0 ls0 ws0">Time</div><div class="t m0 xd h3 y28 ff4 fs2 fc2 sc0 ls0 ws0">Node.1<span class="_ _8"></span>Client<span class="_ _9"> </span>Node.2<span class="_ _a"> </span>Node.3</div></div><div class="pi" data-data="{&quot;ctm&quot;:[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}"></div></div>
<div id="pfc" class="pf w0 h0" data-page-no="c"><div class="pc pcc w0 h0"><img class="bi x0 y0 w0 h0" alt="" src="/img/wiki-paxos/bgc.jpg"><div class="t m0 x3 h5 y4 ff2 fs3 fc0 sc1 ls0 ws0">多数派写<span class="ff1 sc0">. </span>后写入<span class="ff3">优胜</span></div><div class="t m0 x3 h6 y1c ff2 fs1 fc1 sc0 ls0 ws0">最后<span class="ff4">1</span>次写入覆盖先前写</div><div class="t m0 x3 h6 y40 ff2 fs1 fc1 sc0 ls0 ws0">入<span class="ff4">.</span></div><div class="t m0 x3 h6 y41 ff2 fs1 fc1 sc0 ls0 ws0">所有写入操作需要有<span class="ff4">1</span>个全</div><div class="t m0 x3 h2 y1e ff2 fs1 fc1 sc0 ls0 ws0">局<span class="ff3">顺</span>序：<span class="ff3">时间</span>戳</div><div class="t m0 xa hb y27 ff4 fs5 fc2 sc0 ls0 ws0">Time</div><div class="t m0 xd h3 y28 ff4 fs2 fc2 sc0 ls0 ws0">Node.1<span class="_ _8"></span>Client<span class="_ _9"> </span>Node.2<span class="_ _a"> </span>Node.3</div></div><div class="pi" data-data="{&quot;ctm&quot;:[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}"></div></div>
<div id="pfd" class="pf w0 h0" data-page-no="d"><div class="pc pcd w0 h0"><img class="bi x0 y0 w0 h0" alt="" src="/img/wiki-paxos/bgd.jpg"><div class="t m0 x3 h6 y1c ff4 fs1 fc2 sc0 ls0 ws0">: <span class="ff2">高可靠性</span>.</div><div class="t m0 x3 h6 y40 ff4 fs1 fc2 sc0 ls0 ws0">: <span class="ff2">高可用性</span>.</div><div class="t m0 x3 h2 y1d ff4 fs1 fc2 sc0 ls0 ws0">: <span class="ff2">数据完整性有保<span class="ff3">证</span></span>.</div><div class="t m0 xe hf y42 ff3 fs6 fc2 sc0 ls0 ws0">够<span class="ff2">了</span>吗<span class="ff2">？</span></div><div class="t m0 x3 h4 y4 ff2 fs3 fc0 sc1 ls0 ws0">多数派写<span class="ff1 sc0">..</span></div></div><div class="pi" data-data="{&quot;ctm&quot;:[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}"></div></div>
<div id="pfe" class="pf w0 h0" data-page-no="e"><div class="pc pce w0 h0"><img class="bi x0 y0 w0 h0" alt="" src="/img/wiki-paxos/bge.jpg"><div class="t m0 x3 h4 y4 ff2 fs3 fc0 sc1 ls0 ws0">多数派写<span class="ff1 sc0">... W + R &gt; N</span></div><div class="t m0 x3 h6 y1c ff2 fs1 fc2 sc0 ls0 ws0">一致性<span class="ff4">:</span></div><div class="t m0 x4 h2 y40 ff4 fs1 fc2 sc0 ls0 ws0"><span class="ff2">最<span class="ff3">终</span>一致性</span></div><div class="t m0 x3 h2 y41 ff2 fs1 fc2 sc0 ls0 ws0">事<span class="ff3">务</span>性<span class="ff4">:    </span></div><div class="t m0 x4 h6 y1e ff4 fs1 fc2 sc0 ls0 ws0"> <span class="ff2">非原子更新</span> </div><div class="t m0 x4 h2 y38 ff4 fs1 fc2 sc0 ls0 ws0"> <span class="ff3">脏读</span> </div><div class="t m0 x4 h2 y1f ff4 fs1 fc2 sc0 ls0 ws0"> <span class="ff2">更新<span class="ff3">丢</span>失<span class="ff3">问题</span></span> </div><div class="t m0 x3 he y43 ff4 fs4 fc3 sc0 ls0 ws0">http://en.wikipedia.org/wiki/Concurrency_control</div><a class="l" target="_blank" rel="noopener" href="http://en.wikipedia.org/wiki/Concurrency_control"><div class="d m1" style="border-style:none;position:absolute;left:42.750000px;bottom:57.374060px;width:508.242200px;height:26.812500px;background-color:rgba(255,255,255,0.000001);"></div></a><a class="l" target="_blank" rel="noopener" href="http://en.wikipedia.org/wiki/Concurrency_control"><div class="d m1" style="border-style:none;position:absolute;left:550.992200px;bottom:56.096718px;width:0.000000px;height:33.527342px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data="{&quot;ctm&quot;:[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}"></div></div>
<div id="pff" class="pf w0 h0" data-page-no="f"><div class="pc pcf w0 h0"><img class="bi x0 y0 w0 h0" alt="" src="/img/wiki-paxos/bgf.jpg"><div class="t m0 x3 h5 y4 ff2 fs3 fc0 sc1 ls0 ws0">一个假想存<span class="ff3">储</span>服<span class="ff3">务</span></div><div class="t m0 xf h8 y44 ff4 fs4 fc1 sc0 ls0 ws0">●<span class="_ _4"> </span><span class="ff2">一个有</span>3<span class="ff2">个存<span class="ff3">储节</span>点的存<span class="ff3">储</span>服<span class="ff3">务</span>集群</span>.</div><div class="t m0 xf h8 y45 ff4 fs4 fc1 sc0 ls0 ws0">●<span class="_ _4"> </span><span class="ff2">使用多数派<span class="ff3">读</span>写的策略</span>.</div><div class="t m0 xf h8 y46 ff4 fs4 fc1 sc0 ls0 ws0">●<span class="_ _4"> </span><span class="ff2">只存<span class="ff3">储</span></span>1<span class="ff2">个<span class="ff3">变</span>量</span>“i”.</div><div class="t m0 xf h8 y47 ff4 fs4 fc1 sc0 ls0 ws0">●<span class="_ _4"> </span>“i” <span class="ff2">的每次更新<span class="ff3">对应</span>有多个版本</span>: i1, i2, i3…</div><div class="t m0 xf h8 y48 ff4 fs4 fc1 sc0 ls0 ws0">●<span class="_ _4"> </span><span class="ff3">这<span class="ff2">个存</span>储<span class="ff2">系</span>统<span class="ff2">支持</span></span>3<span class="ff2">个命令</span>:</div><div class="t m0 x4 h8 y49 ff4 fs4 fc1 sc0 ls0 ws0">get <span class="_ _b"> </span>/* <span class="ff3">读<span class="ff2">最新的</span></span> “i” */</div><div class="t m0 x4 h8 y4a ff4 fs4 fc1 sc0 ls0 ws0">set &lt;n&gt; <span class="_ _c"> </span>/* <span class="ff3">设<span class="ff2">置下个版本的</span></span>i<span class="ff2">的<span class="ff3">值为</span></span> &lt;n&gt; */</div><div class="t m0 x4 h8 y4b ff4 fs4 fc1 sc0 ls0 ws0">inc &lt;n&gt; <span class="_ _d"> </span>/* <span class="ff3">对</span>“i” <span class="ff2">加</span>&lt;n&gt;<span class="ff2">，也生成</span>1<span class="ff2">个新版本</span> */</div><div class="t m0 x3 h8 y4c ff2 fs4 fc2 sc0 ls0 ws0">我<span class="ff3">们</span>将用<span class="ff3">这</span>个存<span class="ff3">储</span>系<span class="ff3">统</span>来演示多数派<span class="ff3">读</span>写策略的不足，</div><div class="t m0 x3 h8 y4d ff2 fs4 fc2 sc0 ls0 ws0">以及如何用<span class="ff4">paxos</span>解决<span class="ff3">这</span>些<span class="ff3">问题<span class="ff4">.</span></span></div></div><div class="pi" data-data="{&quot;ctm&quot;:[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}"></div></div>
<div id="pf10" class="pf w0 h0" data-page-no="10"><div class="pc pc10 w0 h0"><img class="bi x0 y0 w0 h0" alt="" src="/img/wiki-paxos/bg10.jpg"><div class="t m0 x3 h5 y4 ff2 fs3 fc0 sc1 ls0 ws0">一个假想存<span class="ff3">储</span>服<span class="ff3">务<span class="ff1 sc0">.</span>实现</span></div><div class="t m0 x3 h8 y44 ff2 fs4 fc1 sc0 ls0 ws0">命令<span class="ff3">实现</span>：</div><div class="t m0 x3 h8 y4e ff4 fs4 fc1 sc0 ls0 ws0">"set" → <span class="ff2">直接<span class="ff3">对应</span>多数派写</span>.</div><div class="t m0 x3 h8 y4f ff4 fs4 fc1 sc0 ls0 ws0">"inc" → (<span class="ff2">最<span class="ff3">简单</span>的事<span class="ff3">务</span>型操作</span>):</div><div class="t m0 x4 h8 y50 ff4 fs4 fc1 sc0 ls0 ws0">1. <span class="ff2">通<span class="ff3">过</span>多数派<span class="ff3">读</span>，<span class="ff3">读</span>取最新的</span> “i”: i1</div><div class="t m0 x4 he y51 ff4 fs4 fc1 sc0 ls0 ws0">2. Let i2 = i1 + n</div><div class="t m0 x4 he y52 ff4 fs4 fc1 sc0 ls0 ws0">3. set i2</div><div class="t m0 x10 he y53 ff4 fs4 fc2 sc0 ls0 ws0">X</div><div class="t m0 x11 h3 y54 ff4 fs2 fc2 sc0 ls0 ws0">set i2=3</div><div class="t m0 x10 he y55 ff4 fs4 fc2 sc0 ls0 ws0">X</div><div class="t m0 x11 h3 y56 ff4 fs2 fc2 sc0 ls0 ws0">get i</div><div class="t m0 x12 h3 y57 ff4 fs2 fc2 sc0 ls0 ws0">2</div><div class="t m0 x13 h10 y58 ff4 fs7 fc2 sc0 ls0 ws0">1</div><div class="t m0 x14 h3 y57 ff4 fs2 fc2 sc0 ls0 ws0">2</div><div class="t m0 x15 h10 y58 ff4 fs7 fc2 sc0 ls0 ws0">1</div><div class="t m0 x16 h3 y57 ff4 fs2 fc2 sc0 ls0 ws0">0</div><div class="t m0 x17 h10 y58 ff4 fs7 fc2 sc0 ls0 ws0">0</div><div class="t m0 x12 h3 y59 ff4 fs2 fc2 sc0 ls0 ws0">3</div><div class="t m0 x13 h10 y5a ff4 fs7 fc2 sc0 ls0 ws0">2</div><div class="t m0 x14 h3 y59 ff4 fs2 fc2 sc0 ls0 ws0">2</div><div class="t m0 x15 h10 y5a ff4 fs7 fc2 sc0 ls0 ws0">1</div><div class="t m0 x16 h3 y59 ff4 fs2 fc2 sc0 ls0 ws0">3</div><div class="t m0 x17 h10 y5a ff4 fs7 fc2 sc0 ls0 ws0">2</div><div class="t m0 x10 he y5b ff4 fs4 fc2 sc0 ls0 ws0">X</div><div class="t m0 x11 h3 y5c ff4 fs2 fc2 sc0 ls0 ws0">get i1=2</div><div class="t m0 x18 he y5d ff4 fs4 fc2 sc0 ls0 ws0">i2 = i1 + 1</div><div class="t m0 x12 h3 y5e ff4 fs2 fc2 sc0 ls0 ws0">3</div><div class="t m0 x13 h10 y5f ff4 fs7 fc2 sc0 ls0 ws0">2</div><div class="t m0 x14 h3 y5e ff4 fs2 fc2 sc0 ls0 ws0">2</div><div class="t m0 x15 h10 y5f ff4 fs7 fc2 sc0 ls0 ws0">1</div><div class="t m0 x16 h3 y5e ff4 fs2 fc2 sc0 ls0 ws0">3</div><div class="t m0 x17 h10 y5f ff4 fs7 fc2 sc0 ls0 ws0">2</div></div><div class="pi" data-data="{&quot;ctm&quot;:[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}"></div></div>
<div id="pf11" class="pf w0 h0" data-page-no="11"><div class="pc pc11 w0 h0"><img class="bi x0 y0 w0 h0" alt="" src="/img/wiki-paxos/bg11.jpg"><div class="t m0 x19 h3 y60 ff4 fs2 fc2 sc0 ls0 ws0">set i2=3</div><div class="t m0 x19 h3 y61 ff4 fs2 fc2 sc0 ls0 ws0">OK</div><div class="t m0 x1a h3 y62 ff4 fs2 fc2 sc0 ls0 ws0">set i2=4</div><div class="t m0 x3 h5 y4 ff2 fs3 fc0 sc1 ls0 ws0">一个假想存<span class="ff3">储</span>服<span class="ff3">务<span class="ff1 sc0">..</span></span>并<span class="ff3">发问题</span></div><div class="t m0 x1b he y63 ff4 fs4 fc2 sc0 ls0 ws0">X</div><div class="t m0 x1b he y64 ff4 fs4 fc2 sc0 ls0 ws0">X</div><div class="t m0 x19 h3 y65 ff4 fs2 fc2 sc0 ls0 ws0">get i</div><div class="t m0 x1c h3 y66 ff4 fs2 fc2 sc0 ls0 ws0">2</div><div class="t m0 x1d h10 y67 ff4 fs7 fc2 sc0 ls0 ws0">1</div><div class="t m0 x1e h3 y66 ff4 fs2 fc2 sc0 ls0 ws0">2</div><div class="t m0 x1f h10 y67 ff4 fs7 fc2 sc0 ls0 ws0">1</div><div class="t m0 x20 h3 y66 ff4 fs2 fc2 sc0 ls0 ws0">0</div><div class="t m0 x21 h10 y67 ff4 fs7 fc2 sc0 ls0 ws0">0</div><div class="t m0 x1c hc y68 ff1 fs2 fc2 sc0 ls0 ws0">3</div><div class="t m0 x1d h11 y69 ff1 fs7 fc2 sc0 ls0 ws0">2</div><div class="t m0 x1e h3 y68 ff4 fs2 fc2 sc0 ls0 ws0">2</div><div class="t m0 x1f h10 y69 ff4 fs7 fc2 sc0 ls0 ws0">1</div><div class="t m0 x20 hc y68 ff1 fs2 fc2 sc0 ls0 ws0">3</div><div class="t m0 x21 h11 y69 ff1 fs7 fc2 sc0 ls0 ws0">2</div><div class="t m0 x1c h3 y6a ff4 fs2 fc2 sc0 ls0 ws0">5</div><div class="t m0 x1d h10 y6b ff4 fs7 fc2 sc0 ls0 ws0">3</div><div class="t m0 x1e h3 y6a ff4 fs2 fc2 sc0 ls0 ws0">2</div><div class="t m0 x1f h10 y6b ff4 fs7 fc2 sc0 ls0 ws0">1</div><div class="t m0 x20 h3 y6a ff4 fs2 fc2 sc0 ls0 ws0">5</div><div class="t m0 x21 h10 y6b ff4 fs7 fc2 sc0 ls0 ws0">3</div><div class="t m0 x1b he y6c ff4 fs4 fc2 sc0 ls0 ws0">X</div><div class="t m0 x19 h3 y6d ff4 fs2 fc2 sc0 ls0 ws0">get i1=2</div><div class="t m0 x22 he y6e ff4 fs4 fc2 sc0 ls0 ws0">i2 = i1 + 1</div><div class="t m0 x23 h8 y6f ff2 fs4 fc1 sc0 ls0 ws0">我<span class="ff3">们</span>期待最<span class="ff3">终<span class="ff4">X</span></span>可以<span class="ff3">读</span>到<span class="ff4">i3=5, </span></div><div class="t m0 x23 h8 y70 ff3 fs4 fc1 sc0 ls0 ws0">这<span class="ff2">需要<span class="ff4">Y</span>能知道<span class="ff4">X</span>已</span>经<span class="ff2">写入了<span class="ff4">i2</span>。如何</span>实现这<span class="ff2">个机制？</span></div><div class="t m0 x24 he y71 ff4 fs4 fc2 sc0 ls0 ws0">Y</div><div class="t m0 x25 h3 y72 ff4 fs2 fc2 sc0 ls0 ws0">get i1=2</div><div class="t m0 x26 he y73 ff4 fs4 fc2 sc0 ls0 ws0">Y</div><div class="t m0 x27 he y6e ff4 fs4 fc2 sc0 ls0 ws0">i2 = i1 + 2</div><div class="t m0 x1c h3 y74 ff4 fs2 fc2 sc0 ls0 ws0">3</div><div class="t m0 x1d h10 y75 ff4 fs7 fc2 sc0 ls0 ws0">2</div><div class="t m0 x1e h3 y74 ff4 fs2 fc2 sc0 ls0 ws0">2</div><div class="t m0 x1f h10 y75 ff4 fs7 fc2 sc0 ls0 ws0">1</div><div class="t m0 x20 h3 y74 ff4 fs2 fc2 sc0 ls0 ws0">3</div><div class="t m0 x21 h10 y75 ff4 fs7 fc2 sc0 ls0 ws0">2</div><div class="t m0 x28 h12 y76 ff2 fs2 fc4 sc0 ls0 ws0">此 <span class="ff3">时为</span>了保<span class="_ _e"></span><span class="ff3">证</span>正确，<span class="_ _e"></span><span class="ff4">Y</span>必<span class="ff3">须</span>重新运行多数派<span class="_ _f"> </span><span class="ff3">读</span>，然后再<span class="_ _e"></span><span class="ff3">进</span>行一次多数派写</div><div class="t m0 x29 h12 y77 ff3 fs2 fc5 sc2 ls0 ws0">这<span class="ff1 sc0">1</span><span class="ff2">步<span class="ff1 sc0">Y</span>必<span class="_ _3"></span></span>须<span class="ff2">失</span></div><div class="t m0 x29 h12 y78 ff3 fs2 fc5 sc2 ls0 ws0">败<span class="ff2">。</span></div><div class="t m0 x29 h12 y79 ff2 fs2 fc5 sc2 ls0 ws0">否 <span class="ff3">则<span class="ff1 sc0">X</span></span>写入的<span class="_ _10"></span><span class="ff3">值</span></div><div class="t m0 x29 h12 y7a ff2 fs2 fc5 sc2 ls0 ws0">会 <span class="ff3">丢</span>失。</div></div><div class="pi" data-data="{&quot;ctm&quot;:[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}"></div></div>
<div id="pf12" class="pf w0 h0" data-page-no="12"><div class="pc pc12 w0 h0"><img class="bi x0 y0 w0 h0" alt="" src="/img/wiki-paxos/bg12.jpg"><div class="t m0 x3 h5 y4 ff2 fs3 fc0 sc1 ls0 ws0">一个假想存<span class="ff3">储</span>服<span class="ff3">务<span class="ff1 sc0">...</span></span></div><div class="t m0 x3 h8 y44 ff2 fs4 fc1 sc0 ls0 ws0">在<span class="ff4">X</span>和<span class="ff4">Y</span>的<span class="ff4">2</span>次<span class="ff4">“inc”</span>操作后，<span class="ff3">为</span>了得到正确的<span class="ff4">i3</span>：</div><div class="t m0 x4 h8 y4e ff2 fs4 fc2 sc0 ls0 ws0">整个系<span class="ff3">统</span>里<span class="ff3">对<span class="ff4">i</span></span>的某个版本<span class="ff4">(i2)</span>，只能有<span class="ff4">1</span>次成功写入<span class="ff4">.</span></div><div class="t m0 x3 h8 y50 ff2 fs4 fc1 sc0 ls0 ws0">推广<span class="ff3">为<span class="ff4">:</span></span></div><div class="t m0 x4 h8 y51 ff2 fs4 fc2 sc0 ls0 ws0">在存<span class="ff3">储</span>系<span class="ff3">统</span>中，一个<span class="ff3">值<span class="ff4">(1</span></span>个<span class="ff3">变</span>量的<span class="ff4">1</span>个版本<span class="ff4">)</span>在被<span class="ff3">认为</span>确定</div><div class="t m0 x4 h8 y7b ff4 fs4 fc2 sc0 ls0 ws0">(<span class="ff2">客<span class="ff3">户</span>端接到</span>OK)<span class="ff2">之后，就不允<span class="ff3">许</span>被修改</span>().</div><div class="t m0 x3 h2 y7c ff2 fs1 fc1 sc0 ls0 ws0">如何定<span class="ff3">义<span class="ff4">“</span></span>被确定的<span class="ff4">”?</span></div><div class="t m0 x3 h2 y7d ff2 fs1 fc1 sc0 ls0 ws0">如何避免修改<span class="ff4">“</span>被确定的<span class="ff4">”<span class="ff3">值</span>?</span></div></div><div class="pi" data-data="{&quot;ctm&quot;:[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}"></div></div>
<div id="pf13" class="pf w0 h0" data-page-no="13"><div class="pc pc13 w0 h0"><img class="bi x0 y0 w0 h0" alt="" src="/img/wiki-paxos/bg13.jpg"><div class="t m0 x3 h5 y4 ff2 fs3 fc0 sc1 ls0 ws0">如何确定一个<span class="ff3">值</span></div><div class="t m0 x1b he y7e ff4 fs4 fc2 sc0 ls0 ws0">X</div><div class="t m0 x26 he y7f ff4 fs4 fc2 sc0 ls0 ws0">Y</div><div class="t m0 x19 h3 y80 ff4 fs2 fc2 sc0 ls0 ws0">Any value set?</div><div class="t m0 x1b he y81 ff4 fs4 fc2 sc0 ls0 ws0">X</div><div class="t m0 x19 h3 y82 ff4 fs2 fc2 sc0 ls0 ws0">No</div><div class="t m0 x2a h3 y83 ff4 fs2 fc2 sc0 ls0 ws0">X<span class="_ _11"></span>X<span class="_ _12"> </span>-</div><div class="t m0 x2b h3 y84 ff4 fs2 fc2 sc0 ls0 ws0">-<span class="_ _13"></span>-<span class="_ _13"></span>-</div><div class="t m0 x1a h3 y85 ff4 fs2 fc2 sc0 ls0 ws0">Any value set?</div><div class="t m0 x2b h3 y86 ff4 fs2 fc2 sc0 ls0 ws0">-<span class="_ _13"></span>-<span class="_ _13"></span>-</div><div class="t m0 x26 he y87 ff4 fs4 fc2 sc0 ls0 ws0">Y</div><div class="t m0 x1a h3 y88 ff4 fs2 fc2 sc0 ls0 ws0">Yes, Y gives up</div><div class="t m0 x1b he y89 ff4 fs4 fc2 sc0 ls0 ws0">X</div><div class="t m0 x2a h3 y8a ff4 fs2 fc2 sc0 ls0 ws0">X<span class="_ _11"></span>X<span class="_ _12"> </span>-</div><div class="t m0 x2a h3 y8b ff4 fs2 fc2 sc0 ls0 ws0">X<span class="_ _11"></span>X<span class="_ _12"> </span>-</div><div class="t m0 x3 h8 y33 ff2 fs4 fc1 sc0 ls0 ws0">方案<span class="ff4">: </span><span class="fc2">每次写入一个<span class="ff3">值</span>前，先运行一次多数派<span class="ff3">读</span>，来确<span class="ff3">认</span>是</span></div><div class="t m0 x3 h8 y34 ff2 fs4 fc2 sc0 ls0 ws0">否<span class="ff3">这</span>个<span class="ff3">值</span>（可能）已<span class="ff3">经</span>被写<span class="ff3">过</span>了<span class="ff4">. </span></div></div><div class="pi" data-data="{&quot;ctm&quot;:[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}"></div></div>
<div id="pf14" class="pf w0 h0" data-page-no="14"><div class="pc pc14 w0 h0"><img class="bi x0 y0 w0 h0" alt="" src="/img/wiki-paxos/bg14.jpg"><div class="t m0 x3 h5 y4 ff2 fs3 fc0 sc1 ls0 ws0">如何确定一个<span class="ff3">值<span class="ff1 sc0">.</span></span>并<span class="ff3">发问题</span></div><div class="t m0 x1b he y8c ff4 fs4 fc2 sc0 ls0 ws0">X<span class="_ _14"> </span>Y</div><div class="t m0 x19 h3 y8d ff4 fs2 fc2 sc0 ls0 ws0">Any value set?</div><div class="t m0 x1b he y8e ff4 fs4 fc2 sc0 ls0 ws0">X</div><div class="t m0 x19 h3 y8f ff4 fs2 fc2 sc0 ls0 ws0">No</div><div class="t m0 x26 he y90 ff4 fs4 fc2 sc0 ls0 ws0">Y</div><div class="t m0 x2a h3 y91 ff4 fs2 fc2 sc0 ls0 ws0">Y<span class="_ _11"></span>X<span class="_ _12"> </span>Y</div><div class="t m0 x2a h3 y92 ff4 fs2 fc2 sc0 ls0 ws0">X<span class="_ _11"></span>X<span class="_ _12"> </span>-</div><div class="t m0 x2b h3 y93 ff4 fs2 fc2 sc0 ls0 ws0">-<span class="_ _13"></span>-<span class="_ _13"></span>-</div><div class="t m0 x1a h3 y8d ff4 fs2 fc2 sc0 ls0 ws0">Any value set?</div><div class="t m0 x20 h3 y94 ff4 fs2 fc2 sc0 ls0 ws0">-<span class="_ _13"></span>-<span class="_ _13"></span>-</div><div class="t m0 x26 he y8e ff4 fs4 fc2 sc0 ls0 ws0">Y</div><div class="t m0 x1a h3 y8f ff4 fs2 fc2 sc0 ls0 ws0">No</div><div class="t m0 x1b he y95 ff4 fs4 fc2 sc0 ls0 ws0">X</div><div class="t m0 x3 h8 y96 ff2 fs4 fc1 sc0 ls0 ws0">但是，<span class="ff4">X</span>和<span class="ff4">Y</span>可能同<span class="ff3">时</span>以<span class="ff3">为还</span>没有<span class="ff3">值</span>被写入<span class="ff3">过</span>，然后同<span class="ff3">时</span>开始</div><div class="t m0 x3 h7 y97 ff2 fs4 fc1 sc0 ls0 ws0">写。</div><div class="t m0 x2c h8 y98 ff2 fs4 fc2 sc0 ls0 ws0">更新<span class="ff3">丢</span>失</div></div><div class="pi" data-data="{&quot;ctm&quot;:[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}"></div></div>
<div id="pf15" class="pf w0 h0" data-page-no="15"><div class="pc pc15 w0 h0"><img class="bi x0 y0 w0 h0" alt="" src="/img/wiki-paxos/bg15.jpg"><div class="t m0 x3 h5 y4 ff2 fs3 fc0 sc1 ls0 ws0">如何确定一个<span class="ff3">值<span class="ff1 sc0">..</span></span></div><div class="t m0 x1b he y99 ff4 fs4 fc2 sc0 ls0 ws0">X</div><div class="t m0 x19 h3 y9a ff4 fs2 fc2 sc0 ls0 ws0">Any value set?</div><div class="t m0 x1b he y9b ff4 fs4 fc2 sc0 ls0 ws0">X</div><div class="t m0 x19 h3 y9c ff4 fs2 fc2 sc0 ls0 ws0">No</div><div class="t m0 x26 he y9d ff4 fs4 fc2 sc0 ls0 ws0">Y</div><div class="t m0 x2a h3 y9e ff1 fs2 fc2 sc0 ls0 ws0">Y<span class="_ _11"></span><span class="ff4">X<span class="_ _12"> </span><span class="ff1">Y</span></span></div><div class="t m0 x2d h3 y9f ff4 fs2 fc2 sc0 ls0 ws0">-<span class="_ _13"></span>-<span class="_ _13"></span>-</div><div class="t m0 x20 h3 ya0 ff4 fs2 fc2 sc0 ls0 ws0">-<span class="_ _13"></span>-<span class="_ _13"></span>-</div><div class="t m0 x1b he ya1 ff4 fs4 fc2 sc0 ls0 ws0">X</div><div class="t m0 x26 he ya2 ff4 fs4 fc2 sc0 ls0 ws0">Y</div><div class="t m0 x2d h3 ya3 ff4 fs2 fc2 sc0 ls0 ws0">-<span class="_ _13"></span>-<span class="_ _13"></span>-</div><div class="t m0 x1a h3 ya4 ff4 fs2 fc2 sc0 ls0 ws0">Any value set?</div><div class="t m0 x2e h12 ya5 ff2 fs2 fc2 sc0 ls0 ws0">多数派<span class="_ _e"></span><span class="ff3">读</span>的同<span class="_ _3"></span><span class="ff3">时</span>写入：<span class="_ _e"></span><span class="ff4">X</span>是最后<span class="_ _e"></span><span class="ff3">读</span>的。</div><div class="t m0 x20 h3 ya6 ff4 fs2 fc2 sc0 ls0 ws0">-<span class="_ _13"></span>-<span class="_ _13"></span>-</div><div class="t m0 x26 he ya7 ff4 fs4 fc2 sc0 ls0 ws0">Y</div><div class="t m0 x1a h3 ya8 ff4 fs2 fc2 sc0 ls0 ws0">No</div><div class="t m0 x2f h12 ya9 ff2 fs2 fc2 sc0 ls0 ws0">多数派<span class="_ _e"></span><span class="ff3">读</span>的同<span class="_ _3"></span><span class="ff3">时</span>写入：<span class="_ _e"></span><span class="ff4">Y</span>是最后<span class="_ _e"></span><span class="ff3">读</span>的</div><div class="t m0 x30 h3 yaa ff1 fs2 fc2 sc0 ls0 ws0">X<span class="_ _12"> </span><span class="ff4">-<span class="_ _13"></span>-</span></div><div class="t m0 x3 h8 y33 ff2 fs4 fc1 sc0 ls0 ws0">方案改<span class="ff3">进<span class="ff4">:</span><span class="fc2">让<span class="ff2">存</span>储节<span class="ff2">点</span>记<span class="ff2">住</span>谁<span class="ff2">最后<span class="ff4">1</span>次做</span>过<span class="ff4">“<span class="ff2">写前</span></span>读<span class="ff2">取<span class="ff4">”</span>，并拒</span></span></span></div><div class="t m0 x3 h8 y34 ff3 fs4 fc2 sc0 ls0 ws0">绝<span class="ff2">之前其他的<span class="ff4">“</span>写前</span>读<span class="ff2">取<span class="ff4">”</span>的写入操作。</span></div><div class="t m0 x1a h12 yab ff3 fs2 fc6 sc0 ls0 ws0">现<span class="ff2">在</span>节<span class="ff2">点<span class="_ _3"></span><span class="ff4">1</span>、<span class="_ _3"></span><span class="ff4">2</span>只接受<span class="_ _e"></span><span class="ff4">X</span>的写入</span></div><div class="t m0 x31 h12 yac ff3 fs2 fc5 sc0 ls0 ws0">现<span class="ff2">在</span>节<span class="ff2">点<span class="_ _3"></span><span class="ff4">2</span>、<span class="_ _3"></span><span class="ff4">3</span>只接受<span class="_ _e"></span><span class="ff4">Y</span>的写入</span></div></div><div class="pi" data-data="{&quot;ctm&quot;:[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}"></div></div>
<div id="pf16" class="pf w0 h0" data-page-no="16"><div class="pc pc16 w0 h0"><img class="bi x0 y0 w0 h0" alt="" src="/img/wiki-paxos/bg16.jpg"><div class="t m0 x3 h5 y4 ff2 fs3 fc0 sc1 ls0 ws0">如何确定一个<span class="ff3">值<span class="ff1 sc0">...</span></span></div><div class="t m0 x3 h8 y44 ff2 fs4 fc1 sc0 ls0 ws0">使用<span class="ff3">这</span>个策略，一个<span class="ff3">值<span class="ff4">(i</span></span>的每个版本<span class="ff4">)</span>可以被安全的存<span class="ff3">储<span class="ff4">.</span></span></div><div class="t m0 x3 h8 y4f ff4 fs4 fc1 sc0 ls0 ws0">Leslie Lamport <span class="ff2">写了个<span class="ff3">这</span>个算法的</span>paper.</div></div><div class="pi" data-data="{&quot;ctm&quot;:[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}"></div></div>
<div id="pf17" class="pf w0 h0" data-page-no="17"><div class="pc pc17 w0 h0"><img class="bi x0 y0 w0 h0" alt="" src="/img/wiki-paxos/bg17.jpg"><div class="t m0 x32 h1 yad ff1 fs0 fc0 sc0 ls0 ws0">Paxos</div></div><div class="pi" data-data="{&quot;ctm&quot;:[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}"></div></div>
<div id="pf18" class="pf w0 h0" data-page-no="18"><div class="pc pc18 w0 h0"><img class="bi x0 y0 w0 h0" alt="" src="/img/wiki-paxos/bg18.jpg"><div class="t m0 x3 h4 y4 ff1 fs3 fc0 sc0 ls0 ws0">Paxos<span class="ff2 sc1">是什么</span></div><div class="t m0 x3 h2 y5 ff4 fs1 fc2 sc0 ls0 ws0">●<span class="_ _4"> </span><span class="ff2">一个可靠的存<span class="ff3">储</span>系<span class="ff3">统</span></span>: <span class="ff2">基于多数派<span class="ff3">读</span>写</span>.</div><div class="t m0 x3 h2 yae ff4 fs1 fc2 sc0 ls0 ws0">●<span class="_ _4"> </span><span class="ff2">每个</span>paxos<span class="ff3">实<span class="ff2">例用来存</span>储<span class="ff2">一个</span>值</span>.</div><div class="t m0 x3 h2 yaf ff4 fs1 fc2 sc0 ls0 ws0">●<span class="_ _4"> </span><span class="ff2">用</span>2<span class="ff3">轮</span>RPC<span class="ff2">来确定一个<span class="ff3">值</span></span>.</div><div class="t m0 x3 h2 yb0 ff4 fs1 fc2 sc0 ls0 ws0">●<span class="_ _4"> </span><span class="ff2">一个<span class="ff3">值</span></span>‘<span class="ff2">确定</span>’<span class="ff2">后不能被修改</span>.</div><div class="t m0 x3 h6 yb1 ff4 fs1 fc2 sc0 ls0 ws0">●<span class="_ _4"> </span>‘<span class="ff2">确定</span>’<span class="ff2">指被多数派接受写入</span>.</div><div class="t m0 x3 h2 yb2 ff4 fs1 fc2 sc0 ls0 ws0">●<span class="_ _4"> </span><span class="ff3">强<span class="ff2">一致性</span></span>.</div></div><div class="pi" data-data="{&quot;ctm&quot;:[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}"></div></div>
<div id="pf19" class="pf w0 h0" data-page-no="19"><div class="pc pc19 w0 h0"><img class="bi x0 y0 w0 h0" alt="" src="/img/wiki-paxos/bg19.jpg"><div class="t m0 x3 h13 y4 ff1 fs3 fc0 sc0 ls0 ws0">Paxos</div><div class="t m0 x3 hd y1c ff4 fs1 fc1 sc0 ls0 ws0">Classic Paxos</div><div class="t m0 x4 h8 yb3 ff4 fs4 fc1 sc0 ls0 ws0">1<span class="ff2">个<span class="ff3">实</span>例</span>(<span class="ff2">确定</span>1<span class="ff2">个<span class="ff3">值</span></span>)<span class="ff2">写入需要</span>2<span class="ff3">轮</span>RPC.</div><div class="t m0 x3 hd yb4 ff4 fs1 fc1 sc0 ls0 ws0">Multi Paxos</div><div class="t m0 x4 h8 yb5 ff3 fs4 fc1 sc0 ls0 ws0">约为<span class="ff4">1</span>轮<span class="ff4">RPC<span class="ff2">，确定</span>1<span class="ff2">个</span></span>值<span class="ff4">(<span class="ff2">第</span>1<span class="ff2">次</span>RPC<span class="ff2">做了合并</span>).</span></div><div class="t m0 x3 hd yb6 ff4 fs1 fc1 sc0 ls0 ws0">Fast Paxos</div><div class="t m0 x4 h8 yb7 ff2 fs4 fc1 sc0 ls0 ws0">没冲突：<span class="ff4">1<span class="ff3">轮</span>RPC</span>确定一个<span class="ff3">值<span class="ff4">.</span></span></div><div class="t m0 x4 h8 yb8 ff2 fs4 fc1 sc0 ls0 ws0">有冲突：<span class="ff4">2<span class="ff3">轮</span>RPC</span>确定一个<span class="ff3">值<span class="ff4">.</span></span></div></div><div class="pi" data-data="{&quot;ctm&quot;:[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}"></div></div>
<div id="pf1a" class="pf w0 h0" data-page-no="1a"><div class="pc pc1a w0 h0"><img class="bi x0 y0 w0 h0" alt="" src="/img/wiki-paxos/bg1a.jpg"><div class="t m0 x3 h5 y4 ff1 fs3 fc0 sc0 ls0 ws0">Paxos: <span class="ff3 sc1">执<span class="ff2">行的条件</span></span></div><div class="t m0 x3 h2 y1c ff2 fs1 fc1 sc0 ls0 ws0">存<span class="ff3">储</span>必<span class="ff3">须</span>是可靠的<span class="ff4">:</span></div><div class="t m0 x4 h2 y40 ff2 fs1 fc1 sc0 ls0 ws0">没有数据<span class="ff3">丢</span>失和<span class="ff3">错误</span></div><div class="t m0 x4 h8 y1d ff4 fs4 fc1 sc0 ls0 ws0">/* <span class="ff2">否<span class="ff3">则</span>需要用</span>Byzantine Paxos */</div><div class="t m0 x3 h6 yb9 ff2 fs1 fc1 sc0 ls0 ws0">容忍<span class="ff4">:</span></div><div class="t m0 x4 h2 yba ff2 fs1 fc1 sc0 ls0 ws0">消息<span class="ff3">丢</span>失<span class="ff4">(<span class="ff3">节</span></span>点不可达<span class="ff4">)</span></div><div class="t m0 x4 h6 ybb ff2 fs1 fc1 sc0 ls0 ws0">消息乱序</div></div><div class="pi" data-data="{&quot;ctm&quot;:[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}"></div></div>
<div id="pf1b" class="pf w0 h0" data-page-no="1b"><div class="pc pc1b w0 h0"><img class="bi x0 y0 w0 h0" alt="" src="/img/wiki-paxos/bg1b.jpg"><div class="t m0 x3 h8 y33 ff1 fs4 fc1 sc0 ls0 ws0">Proposer<span class="ff4">: <span class="ff3">发<span class="ff2">起</span></span>paxos<span class="ff2">的<span class="ff3">进</span>程</span>.</span></div><div class="t m0 x3 h8 y35 ff1 fs4 fc1 sc0 ls0 ws0">Acceptor<span class="ff4">: <span class="ff2">存<span class="ff3">储节</span>点，接受、<span class="ff3">处</span>理和存<span class="ff3">储</span>消息</span>.</span></div><div class="t m0 x3 h7 y37 ff1 fs4 fc1 sc0 ls0 ws0">Quorum<span class="ff4">(Acceptor<span class="ff2">的多数派</span>) : n/2+1<span class="_ _3"></span><span class="ff2">个</span>Acceptors.</span></div><div class="t m0 x3 h8 ybc ff1 fs4 fc1 sc0 ls0 ws0">Round<span class="ff2">：<span class="ff4">1<span class="ff3">轮</span></span>包含<span class="ff4">2</span>个<span class="ff3">阶</span>段：<span class="ff4">Phase-1 &amp; Phase-2</span></span></div><div class="t m0 x3 h8 ybd ff2 fs4 fc1 sc0 ls0 ws0">每<span class="ff4">1<span class="ff3">轮</span></span>的<span class="ff3">编</span>号<span class="ff4"> (<span class="ff1">rnd</span>): </span></div><div class="t m0 x4 h8 ybe ff3 fs4 fc1 sc0 ls0 ws0">单调递<span class="ff2">增；后写</span>胜<span class="ff2">出；全局唯一<span class="ff4">(</span>用于区分<span class="ff4">Proposer);</span></span></div><div class="t m0 x3 h4 y4 ff1 fs3 fc0 sc0 ls0 ws0">Paxos: <span class="ff2 sc1">概念</span></div></div><div class="pi" data-data="{&quot;ctm&quot;:[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}"></div></div>
<div id="pf1c" class="pf w0 h0" data-page-no="1c"><div class="pc pc1c w0 h0"><img class="bi x0 y0 w0 h0" alt="" src="/img/wiki-paxos/bg1c.jpg"><div class="t m0 x3 h7 y33 ff4 fs4 fc1 sc0 ls0 ws0">Acceptor<span class="ff2">看到的最大<span class="ff1">rnd </span></span>(<span class="ff1">last_rnd</span>): </div><div class="t m0 x4 h8 y34 ff4 fs4 fc1 sc0 ls0 ws0">Acceptor<span class="ff3">记<span class="ff2">住</span>这<span class="ff2">个</span>值<span class="ff2">来</span>识别<span class="ff2">哪个</span></span>proposer<span class="ff2">可以写。</span></div><div class="t m0 x3 h8 y36 ff4 fs4 fc1 sc0 ls0 ws0">Value (<span class="ff1">v</span>): Acceptor<span class="ff2">接受的<span class="ff3">值</span></span>.</div><div class="t m0 x3 he ybf ff4 fs4 fc1 sc0 ls0 ws0">Value round number (<span class="ff1">vrnd</span>): </div><div class="t m0 x4 h8 ybc ff4 fs4 fc1 sc0 ls0 ws0">Acceptor<span class="ff2">接受的<span class="ff1">v</span>的<span class="ff3">时</span>候的<span class="ff1">rnd</span></span></div><div class="t m0 x3 h8 ybd ff3 fs4 fc1 sc0 ls0 ws0">值<span class="ff4">‘<span class="ff2">被确定的</span>’<span class="ff2">定</span></span>义<span class="ff2">：</span></div><div class="t m0 x4 h8 ybe ff2 fs4 fc1 sc0 ls0 ws0">有多数<span class="ff4">(</span>多于半数<span class="ff4">)</span>个<span class="ff4">Acceptor</span>接受了<span class="ff3">这</span>个<span class="ff3">值<span class="ff4">.</span></span></div><div class="t m0 x3 h4 y4 ff1 fs3 fc0 sc0 ls0 ws0">Paxos: <span class="ff2 sc1">概念</span>.</div></div><div class="pi" data-data="{&quot;ctm&quot;:[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}"></div></div>
<div id="pf1d" class="pf w0 h0" data-page-no="1d"><div class="pc pc1d w0 h0"><img class="bi x0 y0 w0 h0" alt="" src="/img/wiki-paxos/bg1d.jpg"><div class="t m0 x3 h13 y4 ff1 fs3 fc0 sc0 ls0 ws0">Paxos: Classic - phase 1</div><div class="t m0 x33 he yc0 ff4 fs4 fc2 sc0 ls0 ws0">X</div><div class="t m0 x34 h3 yc1 ff4 fs2 fc2 sc0 ls0 ws0">rnd=1</div><div class="t m0 x33 he yc2 ff4 fs4 fc2 sc0 ls0 ws0">X</div><div class="t m0 x34 h3 yc3 ff4 fs2 fc2 sc0 ls0 ws0">last_rnd=0, v=nil, vrnd=0</div><div class="t m0 x34 h3 yc4 ff4 fs2 fc2 sc0 ls0 ws0">last_rnd=0, v=nil, vrnd=0..</div><div class="t m0 x35 he yc5 ff4 fs4 fc2 sc0 ls0 ws0">Phase 1</div><div class="t m0 x8 h3 yc6 ff4 fs2 fc2 sc0 ls0 ws0">1,<span class="_ _15"></span>1,<span class="_ _16"> </span>-</div><div class="t m0 x36 h3 yc7 ff4 fs2 fc2 sc0 ls0 ws0">-<span class="_ _13"></span>-<span class="_ _13"></span>-</div><div class="t m0 x37 h3 yc8 ff4 fs2 fc2 sc0 ls0 ws0">Proposer X<span class="_ _17"> </span>Acceptor 1,2,3</div><div class="t m0 x3 h8 yc9 ff2 fs4 fc1 sc0 ls0 ws0">当<span class="ff4">Acceptor</span>收到<span class="ff4">phase-1</span>的<span class="ff3">请</span>求<span class="ff3">时</span>：</div><div class="t m0 xf h8 yca ff4 fs4 fc1 sc0 ls0 ws0">●<span class="_ _4"> </span><span class="ff2">如果<span class="ff3">请</span>求中<span class="ff1">rnd</span>比</span>Acceptor<span class="ff2">的<span class="ff1">last_rnd</span>小，<span class="ff3">则</span>拒<span class="ff3">绝请</span>求</span></div><div class="t m0 xf h8 ycb ff4 fs4 fc1 sc0 ls0 ws0">●<span class="_ _4"> </span><span class="ff2">将<span class="ff3">请</span>求中的<span class="ff1">rnd</span>保存到本地的<span class="ff1">last_rnd</span></span>.</div><div class="t m0 x4 h9 ycc ff2 fs5 fc1 sc0 ls0 ws0">从此<span class="ff3">这</span>个<span class="ff4">Acceptor</span>只接受<span class="ff3">带</span>有<span class="ff3">这</span>个<span class="ff1">last_rnd</span>的<span class="ff1">phase-2<span class="ff3">请</span></span>求。</div><div class="t m0 xf h8 ycd ff4 fs4 fc1 sc0 ls0 ws0">●<span class="_ _4"> </span><span class="ff2">返回<span class="ff3">应</span>答，<span class="ff3">带</span>上自己之前的<span class="ff1">last_rnd</span>和之前已接受的<span class="ff1">v</span></span>.</div></div><div class="pi" data-data="{&quot;ctm&quot;:[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}"></div></div>
<div id="pf1e" class="pf w0 h0" data-page-no="1e"><div class="pc pc1e w0 h0"><img class="bi x0 y0 w0 h0" alt="" src="/img/wiki-paxos/bg1e.jpg"><div class="t m0 x3 h13 y4 ff1 fs3 fc0 sc0 ls0 ws0">Paxos: Classic - phase 1.</div><div class="t m0 x33 he yc0 ff4 fs4 fc2 sc0 ls0 ws0">X</div><div class="t m0 x34 h3 yc1 ff4 fs2 fc2 sc0 ls0 ws0">rnd=1</div><div class="t m0 x33 he yc2 ff4 fs4 fc2 sc0 ls0 ws0">X</div><div class="t m0 x35 he yc5 ff4 fs4 fc2 sc0 ls0 ws0">Phase 1</div><div class="t m0 x8 h3 yc6 ff4 fs2 fc2 sc0 ls0 ws0">1,<span class="_ _15"></span>1,<span class="_ _16"> </span>-</div><div class="t m0 x36 h3 yc7 ff4 fs2 fc2 sc0 ls0 ws0">-<span class="_ _13"></span>-<span class="_ _13"></span>-</div><div class="t m0 x37 h3 yc8 ff4 fs2 fc2 sc0 ls0 ws0">Proposer X<span class="_ _17"> </span>Acceptor 1,2,3</div><div class="t m0 x3 h8 yce ff2 fs4 fc1 sc0 ls0 ws0">当<span class="ff4">Proposer</span>收到<span class="ff4">Acceptor<span class="ff3">发</span></span>回的<span class="ff3">应</span>答：</div><div class="t m0 xf h8 ycf ff4 fs4 fc1 sc0 ls0 ws0">●<span class="_ _4"> </span><span class="ff2">如果<span class="ff3">应</span>答中的<span class="ff1">last_rnd</span>大于<span class="ff3">发</span>出的<span class="ff1">rnd</span></span>: <span class="ff2">退出</span>.</div><div class="t m0 xf h8 yd0 ff4 fs4 fc1 sc0 ls0 ws0">●<span class="_ _4"> </span><span class="ff2">从所有<span class="ff3">应</span>答中<span class="ff3">选择<span class="ff1">vrnd</span></span>最大的<span class="ff1">v</span></span>: </div><div class="t m0 x4 h9 yd1 ff2 fs5 fc1 sc0 ls0 ws0">不能改<span class="ff3">变<span class="ff4">(</span></span>可能<span class="ff4">)</span>已<span class="ff3">经</span>确定的<span class="ff3">值</span></div><div class="t m0 xf h8 yd2 ff4 fs4 fc1 sc0 ls0 ws0">●<span class="_ _4"> </span><span class="ff2">如果所有<span class="ff3">应</span>答的<span class="ff1">v</span>都是空，可以<span class="ff3">选择</span>自己要写入<span class="ff1">v</span></span>.</div><div class="t m0 xf h8 yd3 ff4 fs4 fc1 sc0 ls0 ws0">●<span class="_ _4"> </span><span class="ff2">如果<span class="ff3">应</span>答不<span class="ff3">够</span>多数派，退出</span></div><div class="t m0 x34 h3 yc3 ff4 fs2 fc2 sc0 ls0 ws0">last_rnd=0, v=nil, vrnd=0</div><div class="t m0 x34 h3 yc4 ff4 fs2 fc2 sc0 ls0 ws0">last_rnd=0, v=nil, vrnd=0..</div></div><div class="pi" data-data="{&quot;ctm&quot;:[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}"></div></div>
<div id="pf1f" class="pf w0 h0" data-page-no="1f"><div class="pc pc1f w0 h0"><img class="bi x0 y0 w0 h0" alt="" src="/img/wiki-paxos/bg1f.jpg"><div class="t m0 x3 h13 y4 ff1 fs3 fc0 sc0 ls0 ws0">Paxos: Classic - phase 2</div><div class="t m0 x33 he yd4 ff4 fs4 fc2 sc0 ls0 ws0">X</div><div class="t m0 x34 h3 yd5 ff4 fs2 fc2 sc0 ls0 ws0">v="x", rnd=1</div><div class="t m0 x33 he yd6 ff4 fs4 fc2 sc0 ls0 ws0">X</div><div class="t m0 x34 h3 yd7 ff4 fs2 fc2 sc0 ls0 ws0">Accepted</div><div class="t m0 x35 he yd8 ff4 fs4 fc2 sc0 ls0 ws0">Phase 2</div><div class="t m0 x8 h3 yd9 ff4 fs2 fc2 sc0 ls0 ws0">1,<span class="_ _15"></span>1,<span class="_ _16"> </span>-</div><div class="t m0 x8 h3 yda ff4 fs2 fc2 sc0 ls0 ws0">1,x</div><div class="t m0 x38 h10 ydb ff4 fs7 fc2 sc0 ls0 ws0">1</div><div class="t m0 x39 h3 yda ff4 fs2 fc2 sc0 ls0 ws0">1,x</div><div class="t m0 x3a h10 ydb ff4 fs7 fc2 sc0 ls0 ws0">1</div><div class="t m0 x36 h3 yda ff4 fs2 fc2 sc0 ls0 ws0">-</div><div class="t m0 x37 h3 ydc ff4 fs2 fc2 sc0 ls0 ws0">Proposer X<span class="_ _17"> </span>Acceptor 1,2,3</div><div class="t m0 x3b h3 ydd ff4 fs2 fc2 sc0 ls0 ws0">v=x, vrnd=1</div><div class="t m0 x3 he yde ff4 fs4 fc1 sc0 ls0 ws0">Proposer: </div><div class="t m0 x4 h8 ydf ff3 fs4 fc1 sc0 ls0 ws0">发<span class="ff2">送<span class="ff1">phase-2</span>，</span>带<span class="ff2">上<span class="ff1">rnd</span>和上一步决定的<span class="ff1">v</span></span></div></div><div class="pi" data-data="{&quot;ctm&quot;:[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}"></div></div>
<div id="pf20" class="pf w0 h0" data-page-no="20"><div class="pc pc20 w0 h0"><img class="bi x0 y0 w0 h0" alt="" src="/img/wiki-paxos/bg20.jpg"><div class="t m0 x3 h13 y4 ff1 fs3 fc0 sc0 ls0 ws0">Paxos: Classic - phase 2.</div><div class="t m0 x33 he yd4 ff4 fs4 fc2 sc0 ls0 ws0">X</div><div class="t m0 x34 h3 yd5 ff4 fs2 fc2 sc0 ls0 ws0">v="x", rnd=1</div><div class="t m0 x33 he yd6 ff4 fs4 fc2 sc0 ls0 ws0">X</div><div class="t m0 x34 h3 yd7 ff4 fs2 fc2 sc0 ls0 ws0">Accepted</div><div class="t m0 x35 he yd8 ff4 fs4 fc2 sc0 ls0 ws0">Phase 2</div><div class="t m0 x8 h3 yd9 ff4 fs2 fc2 sc0 ls0 ws0">1,<span class="_ _15"></span>1,<span class="_ _16"> </span>-</div><div class="t m0 x8 h3 yda ff4 fs2 fc2 sc0 ls0 ws0">1,x</div><div class="t m0 x38 h10 ydb ff4 fs7 fc2 sc0 ls0 ws0">1</div><div class="t m0 x39 h3 yda ff4 fs2 fc2 sc0 ls0 ws0">1,x</div><div class="t m0 x3a h10 ydb ff4 fs7 fc2 sc0 ls0 ws0">1</div><div class="t m0 x36 h3 yda ff4 fs2 fc2 sc0 ls0 ws0">-</div><div class="t m0 x37 h3 ydc ff4 fs2 fc2 sc0 ls0 ws0">Proposer X<span class="_ _17"> </span>Acceptor 1,2,3</div><div class="t m0 x3b h3 ydd ff4 fs2 fc2 sc0 ls0 ws0">v=x, vrnd=1</div><div class="t m0 x3 he yde ff4 fs4 fc1 sc0 ls0 ws0">Acceptor:</div><div class="t m0 xf h8 ydf ff4 fs4 fc1 sc0 ls0 ws0">●<span class="_ _4"> </span><span class="ff2">拒<span class="ff3">绝<span class="ff1">rnd</span></span>不等于</span>Acceptor<span class="ff2">的<span class="ff1">last_rnd</span>的<span class="ff3">请</span>求</span></div><div class="t m0 xf h8 ye0 ff4 fs4 fc1 sc0 ls0 ws0">●<span class="_ _4"> </span><span class="ff2">将<span class="ff1">phase-2<span class="ff3">请</span></span>求中的<span class="ff1">v</span>写入本地，<span class="ff3">记</span>此<span class="ff1">v<span class="ff3">为</span></span></span>‘<span class="ff2">已接受的<span class="ff3">值</span></span>’</div><div class="t m0 xf h8 ye1 ff4 fs4 fc1 sc0 ls0 ws0">●<span class="_ _4"> </span><span class="ff1">last_rnd</span>==<span class="ff1">rnd</span> <span class="ff2">保<span class="ff3">证</span>没有其他</span>Proposer<span class="ff2">在此<span class="ff3">过</span>程中写入</span></div><div class="t m0 x4 h8 ye2 ff3 fs4 fc1 sc0 ls0 ws0">过<span class="ff2">其他</span>值</div></div><div class="pi" data-data="{&quot;ctm&quot;:[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}"></div></div>
<div id="pf21" class="pf w0 h0" data-page-no="21"><div class="pc pc21 w0 h0"><img class="bi x0 y0 w0 h0" alt="" src="/img/wiki-paxos/bg21.jpg"><div class="t m0 x3 h4 y4 ff1 fs3 fc0 sc0 ls0 ws0">Paxos: <span class="ff2 sc1">栗子</span> 1: Classic, <span class="_ _3"></span><span class="ff2 sc1">无冲突</span></div><div class="t m0 x33 he ye3 ff4 fs4 fc2 sc0 ls0 ws0">X</div><div class="t m0 x34 h3 ye4 ff4 fs2 fc2 sc0 ls0 ws0">rnd=1</div><div class="t m0 x33 he ye5 ff4 fs4 fc2 sc0 ls0 ws0">X</div><div class="t m0 x34 h3 ye6 ff4 fs2 fc2 sc0 ls0 ws0">last_rnd=0, v=nil, vrnd=0</div><div class="t m0 x33 he ye7 ff4 fs4 fc2 sc0 ls0 ws0">X</div><div class="t m0 x34 h3 ye8 ff4 fs2 fc2 sc0 ls0 ws0">v="x", rnd=1</div><div class="t m0 x33 he ye9 ff4 fs4 fc2 sc0 ls0 ws0">X</div><div class="t m0 x34 h3 yea ff4 fs2 fc2 sc0 ls0 ws0">Accepted</div><div class="t m0 x35 he yeb ff4 fs4 fc2 sc0 ls0 ws0">Phase 1</div><div class="t m0 x35 he yec ff4 fs4 fc2 sc0 ls0 ws0">Phase 2</div><div class="t m0 x8 h3 yed ff4 fs2 fc2 sc0 ls0 ws0">1,<span class="_ _15"></span>1,<span class="_ _16"> </span>-</div><div class="t m0 x36 h3 yee ff4 fs2 fc2 sc0 ls0 ws0">-<span class="_ _13"></span>-<span class="_ _13"></span>-</div><div class="t m0 x8 h3 yef ff4 fs2 fc2 sc0 ls0 ws0">1,<span class="_ _15"></span>1,<span class="_ _16"> </span>-</div><div class="t m0 x8 h3 yf0 ff4 fs2 fc2 sc0 ls0 ws0">1,x</div><div class="t m0 x38 h10 yf1 ff4 fs7 fc2 sc0 ls0 ws0">1</div><div class="t m0 x39 h3 yf0 ff4 fs2 fc2 sc0 ls0 ws0">1,x</div><div class="t m0 x3a h10 yf1 ff4 fs7 fc2 sc0 ls0 ws0">1</div><div class="t m0 x36 h3 yf0 ff4 fs2 fc2 sc0 ls0 ws0">-</div><div class="t m0 x37 h3 yf2 ff4 fs2 fc2 sc0 ls0 ws0">Proposer X<span class="_ _17"> </span>Acceptor 1,2,3</div><div class="t m0 x3b h3 yf3 ff4 fs2 fc2 sc0 ls0 ws0">v=x, vrnd=1</div></div><div class="pi" data-data="{&quot;ctm&quot;:[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}"></div></div>
<div id="pf22" class="pf w0 h0" data-page-no="22"><div class="pc pc22 w0 h0"><img class="bi x0 y0 w0 h0" alt="" src="/img/wiki-paxos/bg22.jpg"><div class="t m0 x3 h5 y4 ff1 fs3 fc0 sc0 ls0 ws0">Paxos: <span class="ff2 sc1">栗子</span> 2.1: <span class="ff2 sc1">解决并<span class="ff3">发</span>写冲突</span></div><div class="t m0 x1b he yf4 ff4 fs4 fc2 sc0 ls0 ws0">X</div><div class="t m0 x3c he yf5 ff4 fs4 fc2 sc0 ls0 ws0">Y</div><div class="t m0 x19 h3 yf6 ff4 fs2 fc2 sc0 ls0 ws0">rnd=1</div><div class="t m0 x1b he yf7 ff4 fs4 fc2 sc0 ls0 ws0">X</div><div class="t m0 x3d h3 yf8 ff4 fs2 fc2 sc0 ls0 ws0">Phase 1 for X</div><div class="t m0 x25 h3 yf9 ff4 fs2 fc2 sc0 ls0 ws0">rnd=2</div><div class="t m0 x25 h3 yfa ff4 fs2 fc2 sc0 ls0 ws0">OK, forget X</div><div class="t m0 x3d h3 yfb ff4 fs2 fc2 sc0 ls0 ws0">Phase 1 for Y</div><div class="t m0 x3c he yfc ff4 fs4 fc2 sc0 ls0 ws0">Y</div><div class="t m0 x1b he yfd ff4 fs4 fc2 sc0 ls0 ws0">X</div><div class="t m0 x3c he yfe ff4 fs4 fc2 sc0 ls0 ws0">Y</div><div class="t m0 x19 h3 yff ff4 fs2 fc2 sc0 ls0 ws0">v="x", rnd=1</div><div class="t m0 x19 h3 y100 ff4 fs2 fc2 sc0 ls0 ws0">Fail</div><div class="t m0 x25 h3 y101 ff4 fs2 fc2 sc0 ls0 ws0">v="y",rnd=2</div><div class="t m0 x25 h3 y102 ff4 fs2 fc2 sc0 ls0 ws0">OK</div><div class="t m0 x3d h3 y103 ff4 fs2 fc2 sc0 ls0 ws0">Phase 2</div><div class="t m0 x3c he y104 ff4 fs4 fc2 sc0 ls0 ws0">Y</div><div class="t m0 x22 h3 y105 ff4 fs2 fc2 sc0 ls0 ws0">round=1</div><div class="t m0 x2 h3 y106 ff4 fs2 fc2 sc0 ls0 ws0">round=2</div><div class="t m0 x3e he y107 ff4 fs4 fc2 sc0 ls0 ws0">Time</div><div class="t m0 x2a h3 y108 ff4 fs2 fc2 sc0 ls0 ws0">2,<span class="ff1">y</span></div><div class="t m0 x3f h11 y109 ff1 fs7 fc2 sc0 ls0 ws0">2</div><div class="t m0 x30 h3 y108 ff4 fs2 fc2 sc0 ls0 ws0">1,x</div><div class="t m0 x40 h10 y109 ff4 fs7 fc2 sc0 ls0 ws0">1</div><div class="t m0 x2b h3 y108 ff4 fs2 fc2 sc0 ls0 ws0">2,<span class="ff1">y</span></div><div class="t m0 x5 h11 y109 ff1 fs7 fc2 sc0 ls0 ws0">2</div><div class="t m0 x2a h3 y10a ff4 fs2 fc2 sc0 ls0 ws0">2,<span class="_ _15"></span>1,x</div><div class="t m0 x40 h10 y10b ff4 fs7 fc2 sc0 ls0 ws0">1</div><div class="t m0 x2b h3 y10a ff4 fs2 fc2 sc0 ls0 ws0">2,</div><div class="t m0 x2a h3 y10c ff4 fs2 fc2 sc0 ls0 ws0">2,<span class="_ _15"></span>1,<span class="ff1">x</span></div><div class="t m0 x40 h11 y10d ff1 fs7 fc2 sc0 ls0 ws0">1</div><div class="t m0 x2b h3 y10c ff4 fs2 fc2 sc0 ls0 ws0">2,</div><div class="t m0 x2a h3 y10e ff1 fs2 fc2 sc0 ls0 ws0">2,<span class="_ _15"></span><span class="ff4">1,<span class="_ _16"> </span><span class="ff1">2,</span></span></div><div class="t m0 x2a h3 y10f ff4 fs2 fc2 sc0 ls0 ws0">1,<span class="_ _15"></span>1,<span class="_ _16"> </span>-</div><div class="t m0 x2a h3 y110 ff4 fs2 fc2 sc0 ls0 ws0">1,<span class="_ _15"></span>1,<span class="_ _16"> </span>-</div><div class="t m0 x2b h3 y111 ff4 fs2 fc2 sc0 ls0 ws0">-<span class="_ _13"></span>-<span class="_ _13"></span>-</div></div><div class="pi" data-data="{&quot;ctm&quot;:[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}"></div></div>
<div id="pf23" class="pf w0 h0" data-page-no="23"><div class="pc pc23 w0 h0"><img class="bi x0 y0 w0 h0" alt="" src="/img/wiki-paxos/bg23.jpg"><div class="t m0 x3 h4 y4 ff1 fs3 fc0 sc0 ls0 ws0">Paxos: <span class="ff2 sc1">栗子</span> 2.2: X<span class="ff2 sc1">不会修改确定的</span>v</div><div class="t m0 x41 he y112 ff4 fs4 fc2 sc0 ls0 ws0">X</div><div class="t m0 x42 h3 y113 ff4 fs2 fc2 sc0 ls0 ws0">rnd=3</div><div class="t m0 x41 he y114 ff4 fs4 fc2 sc0 ls0 ws0">X</div><div class="t m0 x42 h3 y115 ff4 fs2 fc2 sc0 ls0 ws0">v="y",vrnd=2;</div><div class="t m0 x42 h3 y116 ff4 fs2 fc2 sc0 ls0 ws0">v="x",vrnd=1; </div><div class="t m0 x42 h3 y117 ff4 fs2 fc2 sc0 ls0 ws0">choose 'y'</div><div class="t m0 x43 hb y118 ff4 fs5 fc2 sc0 ls0 ws0">Phase 1</div><div class="t m0 x41 he y119 ff4 fs4 fc2 sc0 ls0 ws0">X</div><div class="t m0 x42 h3 y11a ff4 fs2 fc2 sc0 ls0 ws0">v="y",vrnd=3</div><div class="t m0 x35 hb y11b ff4 fs5 fc2 sc0 ls0 ws0">Phase 2</div><div class="t m0 x44 h3 y11c ff4 fs2 fc2 sc0 ls0 ws0">round=3</div><div class="t m0 x45 h3 y11d ff4 fs2 fc2 sc0 ls0 ws0">2,y</div><div class="t m0 x46 h10 y11e ff4 fs7 fc2 sc0 ls0 ws0">2</div><div class="t m0 x47 h3 y11d ff4 fs2 fc2 sc0 ls0 ws0">1,x</div><div class="t m0 x48 h10 y11e ff4 fs7 fc2 sc0 ls0 ws0">1</div><div class="t m0 x49 h3 y11d ff4 fs2 fc2 sc0 ls0 ws0">2,y</div><div class="t m0 x4a h10 y11e ff4 fs7 fc2 sc0 ls0 ws0">2</div><div class="t m0 x45 h3 y11f ff1 fs2 fc2 sc0 ls0 ws0">3<span class="ff4 fc7">,y</span></div><div class="t m0 x46 h10 y120 ff4 fs7 fc7 sc0 ls0 ws0">2</div><div class="t m0 x47 h3 y11f ff1 fs2 fc2 sc0 ls0 ws0">3<span class="ff4 fc7">,x</span></div><div class="t m0 x48 h10 y120 ff4 fs7 fc7 sc0 ls0 ws0">1</div><div class="t m0 x49 h3 y11f ff4 fs2 fc2 sc0 ls0 ws0">2,y</div><div class="t m0 x4a h10 y120 ff4 fs7 fc2 sc0 ls0 ws0">2</div><div class="t m0 x45 h3 y121 ff4 fs2 fc2 sc0 ls0 ws0">3,y</div><div class="t m0 x46 h10 y122 ff4 fs7 fc2 sc0 ls0 ws0">2</div><div class="t m0 x47 h3 y121 ff4 fs2 fc2 sc0 ls0 ws0">3,x</div><div class="t m0 x48 h10 y122 ff4 fs7 fc2 sc0 ls0 ws0">1</div><div class="t m0 x49 h3 y121 ff4 fs2 fc2 sc0 ls0 ws0">2,y</div><div class="t m0 x4a h10 y122 ff4 fs7 fc2 sc0 ls0 ws0">2</div><div class="t m0 x41 he y123 ff4 fs4 fc2 sc0 ls0 ws0">X</div><div class="t m0 x42 h3 y124 ff4 fs2 fc2 sc0 ls0 ws0">OK</div><div class="t m0 x45 hc y125 ff1 fs2 fc2 sc0 ls0 ws0">3,y</div><div class="t m0 x46 h11 y126 ff1 fs7 fc2 sc0 ls0 ws0">3</div><div class="t m0 x47 hc y125 ff1 fs2 fc2 sc0 ls0 ws0">3,y</div><div class="t m0 x48 h11 y126 ff1 fs7 fc2 sc0 ls0 ws0">3</div><div class="t m0 x49 hc y125 ff1 fs2 fc2 sc0 ls0 ws0">3,y</div><div class="t m0 x4a h11 y126 ff1 fs7 fc2 sc0 ls0 ws0">3</div><div class="t m0 x3a h12 y127 ff4 fs2 fc2 sc0 ls0 ws0">X<span class="ff2">只能<span class="_ _3"></span><span class="ff3">选择</span></span>v=“y”<span class="ff2">，因<span class="_ _e"></span><span class="ff3">为</span>它可能</span></div><div class="t m0 x3a h12 y128 ff2 fs2 fc2 sc0 ls0 ws0">是一个被确定的<span class="_ _f"> </span><span class="ff3">值</span>。</div></div><div class="pi" data-data="{&quot;ctm&quot;:[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}"></div></div>
<div id="pf24" class="pf w0 h0" data-page-no="24"><div class="pc pc24 w0 h0"><img class="bi x0 y0 w0 h0" alt="" src="/img/wiki-paxos/bg24.jpg"><div class="t m0 x3 h4 y4 ff1 fs3 fc0 sc0 ls0 ws0">Paxos..<span class="ff2 sc1">其他</span></div><div class="t m0 x3 h7 y33 ff4 fs4 fc1 sc0 ls0 ws0">Learner<span class="ff2">角色</span>:</div><div class="t m0 xf h8 y34 ff4 fs4 fc1 sc0 ls0 ws0">●<span class="_ _4"> </span>Acceptor<span class="ff3">发<span class="ff2">送<span class="ff1">phase-3</span></span></span> <span class="ff2">到所有</span>learner<span class="ff2">角色，<span class="ff3">让</span></span>learner<span class="ff2">知道</span></div><div class="t m0 x4 h8 y129 ff2 fs4 fc1 sc0 ls0 ws0">一个<span class="ff3">值</span>被确定了<span class="ff4">.</span></div><div class="t m0 xf h8 y48 ff4 fs4 fc1 sc0 ls0 ws0">●<span class="_ _4"> </span><span class="ff2">多数<span class="ff3">场</span>合</span>Proposer<span class="ff2">就是</span>1<span class="ff2">个</span>Learner.</div><div class="t m0 x3 he y12a ff4 fs4 fc1 sc0 ls0 ws0">Livelock:</div><div class="t m0 x4 h8 y12b ff2 fs4 fc1 sc0 ls0 ws0">多个<span class="ff4">Proposer</span>并<span class="ff3">发对<span class="ff4">1</span></span>个<span class="ff3">值</span>运行<span class="ff4">paxos</span>的<span class="ff3">时</span>候，可能会互</div><div class="t m0 x3 h8 y12c ff2 fs4 fc1 sc0 ls0 ws0">相覆盖<span class="ff3">对</span>方的<span class="ff1">rnd</span>，然后提升自己的<span class="ff4">rnd</span>再次<span class="ff3">尝试</span>，然后再次<span class="ff3">产</span></div><div class="t m0 x3 h7 y12d ff2 fs4 fc1 sc0 ls0 ws0">生冲突，一直无法完成</div></div><div class="pi" data-data="{&quot;ctm&quot;:[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}"></div></div>
<div id="pf25" class="pf w0 h0" data-page-no="25"><div class="pc pc25 w0 h0"><img class="bi x0 y0 w0 h0" alt="" src="/img/wiki-paxos/bg25.jpg"><div class="t m0 x3 h13 y4 ff1 fs3 fc0 sc0 ls0 ws0">Multi Paxos</div><div class="t m0 x3 h2 y5 ff2 fs1 fc1 sc0 ls0 ws0">将多个<span class="ff4">paxos<span class="ff3">实</span></span>例的<span class="ff4">phase-1</span>合并到<span class="ff4">1</span>个<span class="ff4">RPC</span>；</div><div class="t m0 x3 h2 y11 ff2 fs1 fc1 sc0 ls0 ws0">使得<span class="ff3">这</span>些<span class="ff4">paxos</span>只需要运行<span class="ff4">phase-2</span>即可。</div><div class="t m0 x3 h8 y37 ff3 fs4 fc1 sc0 ls0 ws0">应<span class="ff2">用<span class="ff4">:</span></span></div><div class="t m0 x3 he y12e ff4 fs4 fc1 sc0 ls0 ws0">chubby zookeeper megastore spanner</div></div><div class="pi" data-data="{&quot;ctm&quot;:[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}"></div></div>
<div id="pf26" class="pf w0 h0" data-page-no="26"><div class="pc pc26 w0 h0"><img class="bi x0 y0 w0 h0" alt="" src="/img/wiki-paxos/bg26.jpg"><div class="t m0 x3 h13 y4 ff1 fs3 fc0 sc0 ls0 ws0">Fast Paxos</div><div class="t m0 xf h8 y44 ff4 fs4 fc1 sc0 ls0 ws0">●<span class="_ _4"> </span>Proposer<span class="ff2">直接<span class="ff3">发</span>送<span class="ff1">phase-2</span></span>.</div><div class="t m0 xf h7 y12f ff4 fs4 fc1 sc0 ls0 ws0">●<span class="_ _4"> </span>Fast Paxos<span class="ff2">的<span class="ff1">rnd</span>是</span>0.</div><div class="t m0 x4 h9 y130 ff4 fs5 fc1 sc0 ls0 ws0">0<span class="ff2">保<span class="ff3">证</span>它一定小于任何一个</span>Classic <span class="ff1">rnd</span> <span class="ff2">，所以可以在出<span class="ff3">现</span>冲突<span class="ff3">时</span>安全的回退</span></div><div class="t m0 x4 ha y131 ff2 fs5 fc1 sc0 ls0 ws0">到<span class="ff4">Classic Paxos.</span></div><div class="t m0 xf h8 y132 ff4 fs4 fc1 sc0 ls0 ws0">●<span class="_ _4"> </span>Acceptor<span class="ff2">只在<span class="ff1">v</span>是空<span class="ff3">时</span>才接受</span>Fast <span class="ff1">phase-2<span class="ff3">请<span class="ff2">求</span></span></span></div><div class="t m0 xf h8 y133 ff4 fs4 fc1 sc0 ls0 ws0">●<span class="_ _4"> </span><span class="ff2">如果<span class="ff3">发</span>成冲突，回退到</span>Classic Paxos<span class="ff2">，开始用一个</span> <span class="ff1">rnd</span> &gt; </div><div class="t m0 x4 h7 y134 ff4 fs4 fc1 sc0 ls0 ws0">0<span class="ff2">来运行。</span></div><div class="t m0 x4b h2 y135 ff2 fs1 fc2 sc0 ls0 ws0">但是<span class="ff4">Fast Paxos </span>比<span class="ff4">Classic Paxos</span>高效<span class="ff3">吗</span>？</div></div><div class="pi" data-data="{&quot;ctm&quot;:[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}"></div></div>
<div id="pf27" class="pf w0 h0" data-page-no="27"><div class="pc pc27 w0 h0"><img class="bi x0 y0 w0 h0" alt="" src="/img/wiki-paxos/bg27.jpg"><div class="t m0 x3 h4 y4 ff1 fs3 fc0 sc0 ls0 ws0">Fast Paxos <span class="ff2 sc1">的多数派</span></div><div class="t m0 x2a h3 y136 ff4 fs2 fc2 sc0 ls0 ws0">-<span class="_ _13"></span>-<span class="_ _13"></span>-<span class="_ _18"> </span>-<span class="_ _19"> </span>-</div><div class="t m0 x4c h3 y137 ff4 fs2 fc2 sc0 ls0 ws0">0,x</div><div class="t m0 x4d h10 y138 ff4 fs7 fc2 sc0 ls0 ws0">0</div><div class="t m0 x4e h3 y139 ff4 fs2 fc2 sc0 ls0 ws0">-</div><div class="t m0 x30 h3 y137 ff4 fs2 fc2 sc0 ls0 ws0">0,x</div><div class="t m0 x40 h10 y138 ff4 fs7 fc2 sc0 ls0 ws0">0</div><div class="t m0 x2a h3 y137 ff4 fs2 fc2 sc0 ls0 ws0">0,x</div><div class="t m0 x3f h10 y138 ff4 fs7 fc2 sc0 ls0 ws0">0</div><div class="t m0 x4e h3 y13a ff4 fs2 fc2 sc0 ls0 ws0">0,y</div><div class="t m0 x4f h10 y13b ff4 fs7 fc2 sc0 ls0 ws0">0</div><div class="t m0 x2a h3 y13c ff4 fs2 fc2 sc0 ls0 ws0">0,x</div><div class="t m0 x3f h10 y13d ff4 fs7 fc2 sc0 ls0 ws0">0</div><div class="t m0 x50 he y13e ff4 fs4 fc2 sc0 ls0 ws0">X</div><div class="t m0 x3 h3 y13f ff4 fs2 fc2 sc0 ls0 ws0">fast rnd=0</div><div class="t m0 x50 he y140 ff4 fs4 fc2 sc0 ls0 ws0">X</div><div class="t m0 x51 h3 y141 ff4 fs2 fc2 sc0 ls0 ws0">phase 2</div><div class="t m0 x51 h3 y142 ff4 fs2 fc2 sc0 ls0 ws0">OK</div><div class="t m0 x52 he y143 ff4 fs4 fc2 sc0 ls0 ws0">Y</div><div class="t m0 x53 h3 y144 ff4 fs2 fc2 sc0 ls0 ws0">fast rnd=0</div><div class="t m0 x54 h3 y145 ff4 fs2 fc2 sc0 ls0 ws0">phase 2</div><div class="t m0 x54 h3 y146 ff4 fs2 fc2 sc0 ls0 ws0">2/5; Fails</div><div class="t m0 x2b h3 y139 ff4 fs2 fc2 sc0 ls0 ws0">-</div><div class="t m0 x2b h3 y13a ff4 fs2 fc2 sc0 ls0 ws0">0,y</div><div class="t m0 x55 h10 y13b ff4 fs7 fc2 sc0 ls0 ws0">0</div><div class="t m0 x4c h3 y147 ff4 fs2 fc2 sc0 ls0 ws0">?<span class="_ _1a"> </span>?</div><div class="t m0 x56 h7 y148 ff2 fs4 fc1 sc0 ls0 ws0">如果<span class="ff4">Fast</span>的多数派也是<span class="ff4"> n/2+1 = 3:</span></div><div class="t m0 x56 h8 y149 ff2 fs4 fc1 sc0 ls0 ws0">当上<span class="ff3">图</span>中<span class="ff4">Y<span class="ff3">发现</span></span>冲突，回退到<span class="ff4">Classic</span>的<span class="ff3">时</span>候<span class="ff4">:</span></div><div class="t m0 x57 h8 y14a ff4 fs4 fc1 sc0 ls0 ws0">Y<span class="ff2">无法确定哪个<span class="ff3">值</span>是可能被确定下来的：</span>x</div><div class="t m0 x7 h14 y14b ff4 fs8 fc1 sc0 ls0 ws0">0</div><div class="t m0 x58 he y14a ff4 fs4 fc1 sc0 ls0 ws0"> or y</div><div class="t m0 x59 h14 y14b ff4 fs8 fc1 sc0 ls0 ws0">0</div><div class="t m0 x23 h9 y14c ff2 fs5 fc2 sc0 ls0 ws0">解决方法是<span class="ff3">让</span>未确定的<span class="ff3">值</span>不占据<span class="ff4">n/2+1</span>个<span class="ff3">节</span>点中的多数派<span class="ff4">,</span>因此<span class="ff4">:</span></div><div class="t m0 x23 h9 y14d ff4 fs5 fc2 sc0 ls0 ws0">→ Fast <span class="ff2">的多数派必<span class="ff3">须</span></span>&gt; n*¾; </div><div class="t m0 x23 h9 y14e ff4 fs5 fc2 sc0 ls0 ws0">→ Fast Paxos<span class="ff2">里的<span class="ff3">值</span>被确定的条件是被</span> n*¾+1 <span class="ff2">个</span>Acceptor<span class="ff2">接受</span>.</div></div><div class="pi" data-data="{&quot;ctm&quot;:[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}"></div></div>
<div id="pf28" class="pf w0 h0" data-page-no="28"><div class="pc pc28 w0 h0"><img class="bi x0 y0 w0 h0" alt="" src="/img/wiki-paxos/bg28.jpg"><div class="t m0 x3 h4 y4 ff1 fs3 fc0 sc0 ls0 ws0">Fast Paxos <span class="ff2 sc1">的多数派</span>.</div><div class="t m0 x5a hd y14f ff4 fs1 fc1 sc0 ls0 ws0">Q = n*¾</div><div class="t m0 x5a h8 y150 ff2 fs4 fc1 sc0 ls0 ws0">可用性降低，因<span class="ff3">为<span class="ff4">Fast Paxos</span></span>需要更多的<span class="ff4">Acceptor</span>来工作<span class="ff4">.</span></div><div class="t m0 x5a h7 y151 ff4 fs4 fc1 sc0 ls0 ws0">Fast Paxos <span class="ff2">需要至少</span>5<span class="ff2">个</span>Acceptors<span class="ff2">，才能容忍</span>1<span class="ff2">个</span>Acceptor<span class="ff2">不</span></div><div class="t m0 x5a h7 y152 ff2 fs4 fc1 sc0 ls0 ws0">可用<span class="ff4">.</span></div></div><div class="pi" data-data="{&quot;ctm&quot;:[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}"></div></div>
<div id="pf29" class="pf w0 h0" data-page-no="29"><div class="pc pc29 w0 h0"><img class="bi x0 y0 w0 h0" alt="" src="/img/wiki-paxos/bg29.jpg"><div class="t m0 x3 h5 y4 ff1 fs3 fc0 sc0 ls0 ws0">Fast Paxos 4/5 Y <span class="_ _3"></span><span class="ff3 sc1">发现<span class="ff2">冲突</span></span></div><div class="t m0 x2a h3 y136 ff4 fs2 fc2 sc0 ls0 ws0">-<span class="_ _13"></span>-<span class="_ _13"></span>-<span class="_ _18"> </span>-<span class="_ _19"> </span>-</div><div class="t m0 x4c h3 y137 ff4 fs2 fc2 sc0 ls0 ws0">0,x</div><div class="t m0 x4d h10 y138 ff4 fs7 fc2 sc0 ls0 ws0">0</div><div class="t m0 x4e h3 y139 ff4 fs2 fc2 sc0 ls0 ws0">-</div><div class="t m0 x30 h3 y137 ff4 fs2 fc2 sc0 ls0 ws0">0,x</div><div class="t m0 x40 h10 y138 ff4 fs7 fc2 sc0 ls0 ws0">0</div><div class="t m0 x2a h3 y137 ff4 fs2 fc2 sc0 ls0 ws0">0,x</div><div class="t m0 x3f h10 y138 ff4 fs7 fc2 sc0 ls0 ws0">0</div><div class="t m0 x2b h3 y137 ff4 fs2 fc2 sc0 ls0 ws0">0,x</div><div class="t m0 x55 h10 y138 ff4 fs7 fc2 sc0 ls0 ws0">0</div><div class="t m0 x4e h3 y13a ff4 fs2 fc2 sc0 ls0 ws0">0,y</div><div class="t m0 x4f h10 y13b ff4 fs7 fc2 sc0 ls0 ws0">0</div><div class="t m0 x4c h3 y13c ff4 fs2 fc2 sc0 ls0 ws0">0,x</div><div class="t m0 x4d h10 y13d ff4 fs7 fc2 sc0 ls0 ws0">0</div><div class="t m0 x30 h3 y13c ff4 fs2 fc2 sc0 ls0 ws0">0,x</div><div class="t m0 x40 h10 y13d ff4 fs7 fc2 sc0 ls0 ws0">0</div><div class="t m0 x2a h3 y13c ff4 fs2 fc2 sc0 ls0 ws0">0,x</div><div class="t m0 x3f h10 y13d ff4 fs7 fc2 sc0 ls0 ws0">0</div><div class="t m0 x2b h3 y13c ff4 fs2 fc2 sc0 ls0 ws0">0,x</div><div class="t m0 x55 h10 y13d ff4 fs7 fc2 sc0 ls0 ws0">0</div><div class="t m0 x4e h3 y153 ff1 fs2 fc2 sc0 ls0 ws0">2<span class="ff4">,<span class="fc7">y</span></span></div><div class="t m0 x4f h10 y154 ff4 fs7 fc7 sc0 ls0 ws0">0</div><div class="t m0 x4c h3 y155 ff4 fs2 fc2 sc0 ls0 ws0">0,x</div><div class="t m0 x4d h10 y156 ff4 fs7 fc2 sc0 ls0 ws0">0</div><div class="t m0 x30 h3 y155 ff4 fs2 fc2 sc0 ls0 ws0">0,x</div><div class="t m0 x40 h10 y156 ff4 fs7 fc2 sc0 ls0 ws0">0</div><div class="t m0 x2b h3 y153 ff1 fs2 fc2 sc0 ls0 ws0">2<span class="ff4">,<span class="fc7">x</span></span></div><div class="t m0 x55 h10 y154 ff4 fs7 fc7 sc0 ls0 ws0">0</div><div class="t m0 x2a h3 y153 ff1 fs2 fc2 sc0 ls0 ws0">2<span class="ff4">,<span class="fc7">x</span></span></div><div class="t m0 x3f h10 y154 ff4 fs7 fc7 sc0 ls0 ws0">0</div><div class="t m0 x4e h3 y157 ff4 fs2 fc7 sc0 ls0 ws0">2,<span class="ff1 fc2">x</span></div><div class="t m0 x4f h11 y158 ff1 fs7 fc2 sc0 ls0 ws0">2</div><div class="t m0 x4c h3 y159 ff4 fs2 fc2 sc0 ls0 ws0">0,x</div><div class="t m0 x4d h10 y15a ff4 fs7 fc2 sc0 ls0 ws0">0</div><div class="t m0 x30 h3 y159 ff4 fs2 fc2 sc0 ls0 ws0">0,x</div><div class="t m0 x40 h10 y15a ff4 fs7 fc2 sc0 ls0 ws0">0</div><div class="t m0 x2b h3 y157 ff4 fs2 fc7 sc0 ls0 ws0">2,<span class="ff1 fc2">x</span></div><div class="t m0 x55 h11 y158 ff1 fs7 fc2 sc0 ls0 ws0">2</div><div class="t m0 x2a h3 y157 ff4 fs2 fc7 sc0 ls0 ws0">2,<span class="ff1 fc2">x</span></div><div class="t m0 x3f h11 y158 ff1 fs7 fc2 sc0 ls0 ws0">2</div><div class="t m0 x50 he y13e ff4 fs4 fc2 sc0 ls0 ws0">X</div><div class="t m0 x3 h3 y13f ff4 fs2 fc2 sc0 ls0 ws0">fast rnd=0</div><div class="t m0 x50 he y140 ff4 fs4 fc2 sc0 ls0 ws0">X</div><div class="t m0 x51 h3 y141 ff4 fs2 fc2 sc0 ls0 ws0">phase 2</div><div class="t m0 x51 h3 y142 ff4 fs2 fc2 sc0 ls0 ws0">OK</div><div class="t m0 x52 he y143 ff4 fs4 fc2 sc0 ls0 ws0">Y</div><div class="t m0 x53 h3 y144 ff4 fs2 fc2 sc0 ls0 ws0">fast rnd=0</div><div class="t m0 x54 h3 y145 ff4 fs2 fc2 sc0 ls0 ws0">phase 2</div><div class="t m0 x54 h3 y146 ff4 fs2 fc2 sc0 ls0 ws0">1/5; Fail</div><div class="t m0 x52 he y15b ff4 fs4 fc2 sc0 ls0 ws0">Y</div><div class="t m0 x5b h3 y15c ff4 fs2 fc2 sc0 ls0 ws0">classic rnd=2</div><div class="t m0 x54 h3 y15d ff4 fs2 fc2 sc0 ls0 ws0">phase 1</div><div class="t m0 x54 h3 y15e ff4 fs2 fc2 sc0 ls0 ws0">OK,  "x"</div><div class="t m0 x52 he y15f ff4 fs4 fc2 sc0 ls0 ws0">Y</div><div class="t m0 x54 h3 y160 ff4 fs2 fc2 sc0 ls0 ws0">phase 2</div><div class="t m0 x54 h3 y161 ff4 fs2 fc2 sc0 ls0 ws0">OK, writes "x"</div><div class="t m0 x5c h15 y162 ff4 fs2 fc2 sc0 ls0 ws0">Y<span class="ff2">在 </span>3<span class="ff2">个<span class="_ _3"></span></span>Acceptor<span class="ff2">中看到<span class="_ _e"></span></span>2<span class="ff2">个<span class="_ _3"></span></span>x</div><div class="t m0 x5d h10 y163 ff4 fs7 fc2 sc0 ls0 ws0">0 </div><div class="t m0 x5c h12 y164 ff2 fs2 fc2 sc0 ls0 ws0">因此<span class="_ _3"></span><span class="ff4">Y</span>必<span class="_ _3"></span><span class="ff3">须选择<span class="ff4"> x</span></span></div><div class="t m0 x1b h10 y165 ff4 fs7 fc2 sc0 ls0 ws0">0</div><div class="t m0 x5e h12 y164 ff4 fs2 fc2 sc0 ls0 ws0"> <span class="ff2">，因<span class="_ _3"></span><span class="ff3">为</span></span> x</div><div class="t m0 x5f h10 y165 ff4 fs7 fc2 sc0 ls0 ws0">0</div><div class="t m0 x60 h15 y164 ff2 fs2 fc2 sc0 ls0 ws0">可能</div><div class="t m0 x5c h12 y166 ff2 fs2 fc2 sc0 ls0 ws0">是 <span class="ff4">1</span>个被确定的<span class="_ _1b"></span><span class="ff3">值<span class="ff4">.</span></span></div><div class="t m0 x5c h3 y167 ff4 fs2 fc2 sc0 ls0 ws0">y</div><div class="t m0 x61 h10 y168 ff4 fs7 fc2 sc0 ls0 ws0">0</div><div class="t m0 x62 h12 y167 ff4 fs2 fc2 sc0 ls0 ws0"> <span class="ff2">不可能是<span class="_ _10"></span></span>1<span class="ff2">个被确定的<span class="_ _1b"></span><span class="ff3">值</span>，因</span></div><div class="t m0 x5c h12 y169 ff3 fs2 fc2 sc0 ls0 ws0">为<span class="ff2">即使剩下的<span class="_ _1b"></span><span class="ff4">2</span>个<span class="ff4">Y</span>没有<span class="_ _3"></span></span>联<span class="ff2">系到的</span></div><div class="t m0 x5c h15 y16a ff4 fs2 fc2 sc0 ls0 ws0">Acceptor<span class="ff2">都接受了<span class="_ _10"></span></span>y</div><div class="t m0 x63 h10 y16b ff4 fs7 fc2 sc0 ls0 ws0">0</div><div class="t m0 x64 h15 y16a ff2 fs2 fc2 sc0 ls0 ws0">，也不会达</div><div class="t m0 x5c h15 y16c ff2 fs2 fc2 sc0 ls0 ws0">到 <span class="ff4">(5*¾ ) <span class="_ _3"></span></span>的多数派。</div></div><div class="pi" data-data="{&quot;ctm&quot;:[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}"></div></div>
<div id="pf2a" class="pf w0 h0" data-page-no="2a"><div class="pc pc2a w0 h0"><img class="bi x0 y0 w0 h0" alt="" src="/img/wiki-paxos/bg2a.jpg"><div class="t m0 x3 h4 y4 ff1 fs3 fc0 sc0 ls0 ws0">Fast Paxos 4/5 X Y <span class="_ _3"></span><span class="ff2 sc1">都冲突</span></div><div class="t m0 x2a h3 y136 ff4 fs2 fc2 sc0 ls0 ws0">-<span class="_ _13"></span>-<span class="_ _13"></span>-<span class="_ _18"> </span>-<span class="_ _19"> </span>-</div><div class="t m0 x4c h3 y16d ff4 fs2 fc2 sc0 ls0 ws0">0,x</div><div class="t m0 x4d h10 y16e ff4 fs7 fc2 sc0 ls0 ws0">0</div><div class="t m0 x30 h3 y16d ff4 fs2 fc2 sc0 ls0 ws0">0,x</div><div class="t m0 x40 h10 y16e ff4 fs7 fc2 sc0 ls0 ws0">0</div><div class="t m0 x2a h3 y16d ff4 fs2 fc2 sc0 ls0 ws0">0,x</div><div class="t m0 x3f h10 y16e ff4 fs7 fc2 sc0 ls0 ws0">0</div><div class="t m0 x2b h3 y16f ff4 fs2 fc2 sc0 ls0 ws0">0,y</div><div class="t m0 x55 h10 y170 ff4 fs7 fc2 sc0 ls0 ws0">0</div><div class="t m0 x4e h3 y16f ff4 fs2 fc2 sc0 ls0 ws0">0,y</div><div class="t m0 x4f h10 y170 ff4 fs7 fc2 sc0 ls0 ws0">0</div><div class="t m0 x4c h3 y171 ff1 fs2 fc2 sc0 ls0 ws0">1<span class="ff4 fc7">,x</span></div><div class="t m0 x4d h10 y172 ff4 fs7 fc7 sc0 ls0 ws0">0</div><div class="t m0 x30 h3 y171 ff1 fs2 fc2 sc0 ls0 ws0">1<span class="ff4 fc7">,x</span></div><div class="t m0 x40 h10 y172 ff4 fs7 fc7 sc0 ls0 ws0">0</div><div class="t m0 x2a h3 y171 ff1 fs2 fc2 sc0 ls0 ws0">1<span class="ff4 fc7">,x</span></div><div class="t m0 x3f h10 y172 ff4 fs7 fc7 sc0 ls0 ws0">0</div><div class="t m0 x2b h3 y173 ff4 fs2 fc7 sc0 ls0 ws0">0,y</div><div class="t m0 x55 h10 y174 ff4 fs7 fc7 sc0 ls0 ws0">0</div><div class="t m0 x4e h3 y173 ff4 fs2 fc7 sc0 ls0 ws0">0,y</div><div class="t m0 x4f h10 y174 ff4 fs7 fc7 sc0 ls0 ws0">0</div><div class="t m0 x4c h3 y175 ff4 fs2 fc7 sc0 ls0 ws0">1,x</div><div class="t m0 x4d h10 y176 ff4 fs7 fc7 sc0 ls0 ws0">0</div><div class="t m0 x30 h3 y175 ff4 fs2 fc7 sc0 ls0 ws0">1,x</div><div class="t m0 x40 h10 y176 ff4 fs7 fc7 sc0 ls0 ws0">0</div><div class="t m0 x2b h3 y177 ff1 fs2 fc2 sc0 ls0 ws0">2<span class="ff4 fc7">,y</span></div><div class="t m0 x55 h10 y178 ff4 fs7 fc7 sc0 ls0 ws0">0</div><div class="t m0 x4e h3 y177 ff1 fs2 fc2 sc0 ls0 ws0">2<span class="ff4 fc7">,y</span></div><div class="t m0 x4f h10 y178 ff4 fs7 fc7 sc0 ls0 ws0">0</div><div class="t m0 x2a h3 y177 ff1 fs2 fc2 sc0 ls0 ws0">2<span class="ff4 fc7">,x</span></div><div class="t m0 x3f h10 y178 ff4 fs7 fc7 sc0 ls0 ws0">0</div><div class="t m0 x50 he y13e ff4 fs4 fc2 sc0 ls0 ws0">X</div><div class="t m0 x3 h3 y13f ff4 fs2 fc2 sc0 ls0 ws0">fast rnd=0</div><div class="t m0 x50 he y179 ff4 fs4 fc2 sc0 ls0 ws0">X</div><div class="t m0 x51 h3 y141 ff4 fs2 fc2 sc0 ls0 ws0">phase 2</div><div class="t m0 x51 h3 y17a ff4 fs2 fc2 sc0 ls0 ws0">Conflict</div><div class="t m0 x52 he y17b ff4 fs4 fc2 sc0 ls0 ws0">Y</div><div class="t m0 x53 h3 y17c ff4 fs2 fc2 sc0 ls0 ws0">fast rnd=0</div><div class="t m0 xd h3 y17d ff4 fs2 fc2 sc0 ls0 ws0">phase 2</div><div class="t m0 x52 he y179 ff4 fs4 fc2 sc0 ls0 ws0">Y</div><div class="t m0 xd h3 y17a ff4 fs2 fc2 sc0 ls0 ws0">Conflict</div><div class="t m0 x4c h3 y17e ff4 fs2 fc2 sc0 ls0 ws0">0,x</div><div class="t m0 x4d h10 y17f ff4 fs7 fc2 sc0 ls0 ws0">0</div><div class="t m0 x30 h3 y17e ff4 fs2 fc2 sc0 ls0 ws0">0,x</div><div class="t m0 x40 h10 y17f ff4 fs7 fc2 sc0 ls0 ws0">0</div><div class="t m0 x2a h3 y17e ff4 fs2 fc2 sc0 ls0 ws0">0,x</div><div class="t m0 x3f h10 y17f ff4 fs7 fc2 sc0 ls0 ws0">0</div><div class="t m0 x2b h3 y180 ff4 fs2 fc2 sc0 ls0 ws0">0,y</div><div class="t m0 x55 h10 y181 ff4 fs7 fc2 sc0 ls0 ws0">0</div><div class="t m0 x4e h3 y180 ff4 fs2 fc2 sc0 ls0 ws0">0,y</div><div class="t m0 x4f h10 y181 ff4 fs7 fc2 sc0 ls0 ws0">0</div><div class="t m0 x50 he y182 ff4 fs4 fc2 sc0 ls0 ws0">X</div><div class="t m0 x3 h3 y183 ff4 fs2 fc2 sc0 ls0 ws0">classic rnd=1</div><div class="t m0 x51 h3 y184 ff4 fs2 fc2 sc0 ls0 ws0">phase 1</div><div class="t m0 x52 he y185 ff4 fs4 fc2 sc0 ls0 ws0">Y</div><div class="t m0 x65 h3 y186 ff4 fs2 fc2 sc0 ls0 ws0">classic rnd=2</div><div class="t m0 xd h3 y187 ff4 fs2 fc2 sc0 ls0 ws0">phase 1</div><div class="t m0 x50 he y185 ff4 fs4 fc2 sc0 ls0 ws0">X</div><div class="t m0 x51 h3 y188 ff4 fs2 fc2 sc0 ls0 ws0">OK, only "x"</div><div class="t m0 x52 he y189 ff4 fs4 fc2 sc0 ls0 ws0">Y</div><div class="t m0 xd h3 y18a ff4 fs2 fc2 sc0 ls0 ws0">OK, choose "y"</div><div class="t m0 x52 he y18b ff4 fs4 fc2 sc0 ls0 ws0">Y</div><div class="t m0 xd h3 y18c ff4 fs2 fc2 sc0 ls0 ws0">phase 2</div><div class="t m0 x4e h3 y18d ff4 fs2 fc2 sc0 ls0 ws0">2,y</div><div class="t m0 x4f h10 y18e ff4 fs7 fc2 sc0 ls0 ws0">2</div><div class="t m0 x2b h3 y18d ff4 fs2 fc2 sc0 ls0 ws0">2,y</div><div class="t m0 x55 h10 y18e ff4 fs7 fc2 sc0 ls0 ws0">2</div><div class="t m0 x2a h3 y18d ff4 fs2 fc2 sc0 ls0 ws0">2,y</div><div class="t m0 x3f h10 y18e ff4 fs7 fc2 sc0 ls0 ws0">2</div><div class="t m0 x30 h3 y18d ff4 fs2 fc2 sc0 ls0 ws0">2,y</div><div class="t m0 x40 h10 y18e ff4 fs7 fc2 sc0 ls0 ws0">2</div><div class="t m0 x4c h3 y18d ff4 fs2 fc2 sc0 ls0 ws0">2,y</div><div class="t m0 x4d h10 y18e ff4 fs7 fc2 sc0 ls0 ws0">2</div><div class="t m0 x50 he y18f ff4 fs4 fc2 sc0 ls0 ws0">X</div><div class="t m0 x51 h3 y190 ff4 fs2 fc2 sc0 ls0 ws0">fail in phase 2</div></div><div class="pi" data-data="{&quot;ctm&quot;:[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}"></div></div>
<div id="pf2b" class="pf w0 h0" data-page-no="2b"><div class="pc pc2b w0 h0"><img class="bi x0 y0 w0 h0" alt="" src="/img/wiki-paxos/bg2b.jpg"><div class="t m0 x3 h13 y4 ff1 fs3 fc0 sc0 ls0 ws0">Note</div><div class="t m0 x3 h6 y5 ff2 fs1 fc1 sc0 ls0 ws0">在<span class="ff4"> <span class="ff1">phase-2</span>, Acceptor</span>可以接受<span class="ff4"> <span class="ff1">rnd<span class="_ _3"></span></span> &gt;= <span class="ff1">last_rnd </span></span></div><div class="t m0 x3 h2 y191 ff2 fs1 fc1 sc0 ls0 ws0">的<span class="ff3">请</span>求</div></div><div class="pi" data-data="{&quot;ctm&quot;:[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}"></div></div>
<div id="pf2c" class="pf w0 h0" data-page-no="2c"><div class="pc pc2c w0 h0"><img class="bi x0 y0 w0 h0" alt="" src="/img/wiki-paxos/bg2c.jpg"><div class="t m0 x3 h13 y192 ff1 fs3 fc0 sc0 ls0 ws0">Q&amp;A</div><div class="t m0 x66 h16 y193 ff1 fs6 fc1 sc0 ls0 ws0">Thanks</div><div class="t m0 x32 he y194 ff4 fs4 fc3 sc0 ls0 ws0">drdr.xp@gmail.com</div><div class="t m0 x67 he y195 ff4 fs4 fc3 sc0 ls0 ws0">http://drmingdrmer.github.io</div><div class="t m0 x68 he y196 ff4 fs4 fc1 sc0 ls0 ws0">weibo.com: @drdrxp</div><a class="l" href="mailto:drdr.xp@gmail.com"><div class="d m1" style="border-style:none;position:absolute;left:255.791020px;bottom:221.435090px;width:208.417960px;height:26.812500px;background-color:rgba(255,255,255,0.000001);"></div></a><a class="l" href="mailto:drdr.xp@gmail.com"><div class="d m1" style="border-style:none;position:absolute;left:464.208980px;bottom:221.435090px;width:0.000000px;height:26.812500px;background-color:rgba(255,255,255,0.000001);"></div></a><a class="l" target="_blank" rel="noopener" href="http://drmingdrmer.github.io"><div class="d m1" style="border-style:none;position:absolute;left:213.263670px;bottom:186.935070px;width:293.472660px;height:26.812500px;background-color:rgba(255,255,255,0.000001);"></div></a><a class="l" target="_blank" rel="noopener" href="http://drmingdrmer.github.io"><div class="d m1" style="border-style:none;position:absolute;left:506.736330px;bottom:186.935070px;width:0.000000px;height:26.812500px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data="{&quot;ctm&quot;:[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}"></div></div>
</div>


<blockquote>
<p>本文转载自：<a target="_blank" rel="noopener" href="http://drmingdrmer.github.io/tech/distributed/2015/11/11/paxos-slide.html">可靠分布式系统基础 Paxos 的直观解释</a></p>
</blockquote>
<h2 id="相关链接"><a href="#相关链接" class="headerlink" title="相关链接"></a>相关链接</h2><ol>
<li><a target="_blank" rel="noopener" href="http://drmingdrmer.github.io/tech/distributed/2015/11/11/paxos-slide.html">可靠分布式系统基础 Paxos 的直观解释</a></li>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/232351178">Quorum 复制机制</a></li>
<li><a target="_blank" rel="noopener" href="http://drmingdrmer.github.io/algo/2020/10/18/quorum.html">后分布式时代: 多数派读写的’少数派’实现</a></li>
<li><a target="_blank" rel="noopener" href="http://drmingdrmer.github.io/algo/2020/10/28/paxoskv.html">200行代码实现基于paxos的kv存储</a></li>
</ol>
</div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E4%B8%80%E8%87%B4%E6%80%A7/">分布式一致性</a></div><!--!--><div><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6757924689439593" crossOrigin="anonymous"></script><ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-6757924689439593" data-ad-slot="2352785969"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script></div><script src="/js/pdf2htmlex.js"></script></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/pages/pinterest-arch/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">Pinterest的技术架构</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/pages/weixin-arch/"><span class="level-item">微信的技术架构</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--><div style="width:100%"><script src="https://giscus.app/client.js" data-repo="thetechstack/thetechstack.github.io" data-repo-id="R_kgDOG6Ti1Q" data-category="Announcements" data-category-id="DIC_kwDOG6Ti1c4COQtm" data-mapping="pathname" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="zh-CN" crossOrigin="anonymous" async></script></div></div><!--!--><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen  order-3 is-sticky"><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">目录</h3><ul class="menu-list"><li><a class="level is-mobile" href="#背景"><span class="level-left"><span class="level-item">1</span><span class="level-item">背景</span></span></a></li><li><a class="level is-mobile" href="#Paxos"><span class="level-left"><span class="level-item">2</span><span class="level-item">Paxos</span></span></a></li><li><a class="level is-mobile" href="#相关链接"><span class="level-left"><span class="level-item">3</span><span class="level-item">相关链接</span></span></a></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/img/avatar.jpg"></figure><p class="is-size-6 is-block">公众号：面向问题编程</p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">24</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">4</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">9</p></a></div></div></nav></div></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/%E4%B8%80%E6%96%87%E4%BA%86%E8%A7%A3/"><span class="level-start"><span class="level-item">一文了解</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/categories/%E6%8A%80%E6%9C%AF%E6%9E%B6%E6%9E%84/"><span class="level-start"><span class="level-item">技术架构</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/categories/%E7%BB%BC%E8%BF%B0/"><span class="level-start"><span class="level-item">综述</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E9%97%AE%E9%A2%98/"><span class="level-start"><span class="level-item">问题</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.svg" alt="面向问题编程" height="28"></a><p class="is-size-7"><span>&copy; 2022 面向问题编程</span></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><script type="text/x-mathjax-config">MathJax.Hub.Config({
            'HTML-CSS': {
                matchFontHeight: false
            },
            SVG: {
                matchFontHeight: false
            },
            CommonHTML: {
                matchFontHeight: false
            },
            tex2jax: {
                inlineMath: [
                    ['$','$'],
                    ['\\(','\\)']
                ]
            }
        });</script><script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.9/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>